webpackJsonp([1],[function(t,e,i){i(15),i(9),t.exports=i(44)},,function(t,e,i){var n,r;(function(){function i(t){function e(e,i,n,r,o,s){for(;o>=0&&o<s;o+=t){var a=r?r[o]:o;n=i(n,e[a],a,e)}return n}return function(i,n,r,o){n=x(n,o,4);var s=!R(i)&&C.keys(i),a=(s||i).length,c=t>0?0:a-1;return arguments.length<3&&(r=i[s?s[c]:c],c+=t),e(i,n,r,s,c,a)}}function o(t){return function(e,i,n){i=k(i,n);for(var r=O(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(i(e[o],o,e))return o;return-1}}function s(t,e,i){return function(n,r,o){var s=0,a=O(n);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(i&&o&&a)return o=i(n,r),n[o]===r?o:-1;if(r!==r)return o=e(m.call(n,s,a),C.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(n[o]===r)return o;return-1}}function a(t,e){var i=B.length,n=t.constructor,r=C.isFunction(n)&&n.prototype||u,o="constructor";for(C.has(t,o)&&!C.contains(e,o)&&e.push(o);i--;)o=B[i],o in t&&t[o]!==r[o]&&!C.contains(e,o)&&e.push(o)}var c=this,l=c._,h=Array.prototype,u=Object.prototype,d=Function.prototype,f=h.push,m=h.slice,p=u.toString,g=u.hasOwnProperty,v=Array.isArray,_=Object.keys,y=d.bind,w=Object.create,b=function(){},C=function(t){return t instanceof C?t:this instanceof C?void(this._wrapped=t):new C(t)};"undefined"!=typeof t&&t.exports&&(e=t.exports=C),e._=C,C.VERSION="1.8.3";var x=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)}}return function(){return t.apply(e,arguments)}},k=function(t,e,i){return null==t?C.identity:C.isFunction(t)?x(t,e,i):C.isObject(t)?C.matcher(t):C.property(t)};C.iteratee=function(t,e){return k(t,e,1/0)};var E=function(t,e){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var r=1;r<n;r++)for(var o=arguments[r],s=t(o),a=s.length,c=0;c<a;c++){var l=s[c];e&&void 0!==i[l]||(i[l]=o[l])}return i}},M=function(t){if(!C.isObject(t))return{};if(w)return w(t);b.prototype=t;var e=new b;return b.prototype=null,e},A=function(t){return function(e){return null==e?void 0:e[t]}},S=Math.pow(2,53)-1,O=A("length"),R=function(t){var e=O(t);return"number"==typeof e&&e>=0&&e<=S};C.each=C.forEach=function(t,e,i){e=x(e,i);var n,r;if(R(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var o=C.keys(t);for(n=0,r=o.length;n<r;n++)e(t[o[n]],o[n],t)}return t},C.map=C.collect=function(t,e,i){e=k(e,i);for(var n=!R(t)&&C.keys(t),r=(n||t).length,o=Array(r),s=0;s<r;s++){var a=n?n[s]:s;o[s]=e(t[a],a,t)}return o},C.reduce=C.foldl=C.inject=i(1),C.reduceRight=C.foldr=i(-1),C.find=C.detect=function(t,e,i){var n;if(n=R(t)?C.findIndex(t,e,i):C.findKey(t,e,i),void 0!==n&&n!==-1)return t[n]},C.filter=C.select=function(t,e,i){var n=[];return e=k(e,i),C.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n},C.reject=function(t,e,i){return C.filter(t,C.negate(k(e)),i)},C.every=C.all=function(t,e,i){e=k(e,i);for(var n=!R(t)&&C.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(!e(t[s],s,t))return!1}return!0},C.some=C.any=function(t,e,i){e=k(e,i);for(var n=!R(t)&&C.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(e(t[s],s,t))return!0}return!1},C.contains=C.includes=C.include=function(t,e,i,n){return R(t)||(t=C.values(t)),("number"!=typeof i||n)&&(i=0),C.indexOf(t,e,i)>=0},C.invoke=function(t,e){var i=m.call(arguments,2),n=C.isFunction(e);return C.map(t,function(t){var r=n?e:t[e];return null==r?r:r.apply(t,i)})},C.pluck=function(t,e){return C.map(t,C.property(e))},C.where=function(t,e){return C.filter(t,C.matcher(e))},C.findWhere=function(t,e){return C.find(t,C.matcher(e))},C.max=function(t,e,i){var n,r,o=-(1/0),s=-(1/0);if(null==e&&null!=t){t=R(t)?t:C.values(t);for(var a=0,c=t.length;a<c;a++)n=t[a],n>o&&(o=n)}else e=k(e,i),C.each(t,function(t,i,n){r=e(t,i,n),(r>s||r===-(1/0)&&o===-(1/0))&&(o=t,s=r)});return o},C.min=function(t,e,i){var n,r,o=1/0,s=1/0;if(null==e&&null!=t){t=R(t)?t:C.values(t);for(var a=0,c=t.length;a<c;a++)n=t[a],n<o&&(o=n)}else e=k(e,i),C.each(t,function(t,i,n){r=e(t,i,n),(r<s||r===1/0&&o===1/0)&&(o=t,s=r)});return o},C.shuffle=function(t){for(var e,i=R(t)?t:C.values(t),n=i.length,r=Array(n),o=0;o<n;o++)e=C.random(0,o),e!==o&&(r[o]=r[e]),r[e]=i[o];return r},C.sample=function(t,e,i){return null==e||i?(R(t)||(t=C.values(t)),t[C.random(t.length-1)]):C.shuffle(t).slice(0,Math.max(0,e))},C.sortBy=function(t,e,i){return e=k(e,i),C.pluck(C.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var I=function(t){return function(e,i,n){var r={};return i=k(i,n),C.each(e,function(n,o){var s=i(n,o,e);t(r,n,s)}),r}};C.groupBy=I(function(t,e,i){C.has(t,i)?t[i].push(e):t[i]=[e]}),C.indexBy=I(function(t,e,i){t[i]=e}),C.countBy=I(function(t,e,i){C.has(t,i)?t[i]++:t[i]=1}),C.toArray=function(t){return t?C.isArray(t)?m.call(t):R(t)?C.map(t,C.identity):C.values(t):[]},C.size=function(t){return null==t?0:R(t)?t.length:C.keys(t).length},C.partition=function(t,e,i){e=k(e,i);var n=[],r=[];return C.each(t,function(t,i,o){(e(t,i,o)?n:r).push(t)}),[n,r]},C.first=C.head=C.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:C.initial(t,t.length-e)},C.initial=function(t,e,i){return m.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},C.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:C.rest(t,Math.max(0,t.length-e))},C.rest=C.tail=C.drop=function(t,e,i){return m.call(t,null==e||i?1:e)},C.compact=function(t){return C.filter(t,C.identity)};var V=function(t,e,i,n){for(var r=[],o=0,s=n||0,a=O(t);s<a;s++){var c=t[s];if(R(c)&&(C.isArray(c)||C.isArguments(c))){e||(c=V(c,e,i));var l=0,h=c.length;for(r.length+=h;l<h;)r[o++]=c[l++]}else i||(r[o++]=c)}return r};C.flatten=function(t,e){return V(t,e,!1)},C.without=function(t){return C.difference(t,m.call(arguments,1))},C.uniq=C.unique=function(t,e,i,n){C.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=k(i,n));for(var r=[],o=[],s=0,a=O(t);s<a;s++){var c=t[s],l=i?i(c,s,t):c;e?(s&&o===l||r.push(c),o=l):i?C.contains(o,l)||(o.push(l),r.push(c)):C.contains(r,c)||r.push(c)}return r},C.union=function(){return C.uniq(V(arguments,!0,!0))},C.intersection=function(t){for(var e=[],i=arguments.length,n=0,r=O(t);n<r;n++){var o=t[n];if(!C.contains(e,o)){for(var s=1;s<i&&C.contains(arguments[s],o);s++);s===i&&e.push(o)}}return e},C.difference=function(t){var e=V(arguments,!0,!0,1);return C.filter(t,function(t){return!C.contains(e,t)})},C.zip=function(){return C.unzip(arguments)},C.unzip=function(t){for(var e=t&&C.max(t,O).length||0,i=Array(e),n=0;n<e;n++)i[n]=C.pluck(t,n);return i},C.object=function(t,e){for(var i={},n=0,r=O(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},C.findIndex=o(1),C.findLastIndex=o(-1),C.sortedIndex=function(t,e,i,n){i=k(i,n,1);for(var r=i(e),o=0,s=O(t);o<s;){var a=Math.floor((o+s)/2);i(t[a])<r?o=a+1:s=a}return o},C.indexOf=s(1,C.findIndex,C.sortedIndex),C.lastIndexOf=s(-1,C.findLastIndex),C.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),o=0;o<n;o++,t+=i)r[o]=t;return r};var T=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var o=M(t.prototype),s=t.apply(o,r);return C.isObject(s)?s:o};C.bind=function(t,e){if(y&&t.bind===y)return y.apply(t,m.call(arguments,1));if(!C.isFunction(t))throw new TypeError("Bind must be called on a function");var i=m.call(arguments,2),n=function(){return T(t,n,e,this,i.concat(m.call(arguments)))};return n},C.partial=function(t){var e=m.call(arguments,1),i=function(){for(var n=0,r=e.length,o=Array(r),s=0;s<r;s++)o[s]=e[s]===C?arguments[n++]:e[s];for(;n<arguments.length;)o.push(arguments[n++]);return T(t,i,this,this,o)};return i},C.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)i=arguments[e],t[i]=C.bind(t[i],t);return t},C.memoize=function(t,e){var i=function(n){var r=i.cache,o=""+(e?e.apply(this,arguments):n);return C.has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return i.cache={},i},C.delay=function(t,e){var i=m.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},C.defer=C.partial(C.delay,C,1),C.throttle=function(t,e,i){var n,r,o,s=null,a=0;i||(i={});var c=function(){a=i.leading===!1?0:C.now(),s=null,o=t.apply(n,r),s||(n=r=null)};return function(){var l=C.now();a||i.leading!==!1||(a=l);var h=e-(l-a);return n=this,r=arguments,h<=0||h>e?(s&&(clearTimeout(s),s=null),a=l,o=t.apply(n,r),s||(n=r=null)):s||i.trailing===!1||(s=setTimeout(c,h)),o}},C.debounce=function(t,e,i){var n,r,o,s,a,c=function(){var l=C.now()-s;l<e&&l>=0?n=setTimeout(c,e-l):(n=null,i||(a=t.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,s=C.now();var l=i&&!n;return n||(n=setTimeout(c,e)),l&&(a=t.apply(o,r),o=r=null),a}},C.wrap=function(t,e){return C.partial(e,t)},C.negate=function(t){return function(){return!t.apply(this,arguments)}},C.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},C.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},C.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},C.once=C.partial(C.before,2);var F=!{toString:null}.propertyIsEnumerable("toString"),B=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];C.keys=function(t){if(!C.isObject(t))return[];if(_)return _(t);var e=[];for(var i in t)C.has(t,i)&&e.push(i);return F&&a(t,e),e},C.allKeys=function(t){if(!C.isObject(t))return[];var e=[];for(var i in t)e.push(i);return F&&a(t,e),e},C.values=function(t){for(var e=C.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},C.mapObject=function(t,e,i){e=k(e,i);for(var n,r=C.keys(t),o=r.length,s={},a=0;a<o;a++)n=r[a],s[n]=e(t[n],n,t);return s},C.pairs=function(t){for(var e=C.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n},C.invert=function(t){for(var e={},i=C.keys(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e},C.functions=C.methods=function(t){var e=[];for(var i in t)C.isFunction(t[i])&&e.push(i);return e.sort()},C.extend=E(C.allKeys),C.extendOwn=C.assign=E(C.keys),C.findKey=function(t,e,i){e=k(e,i);for(var n,r=C.keys(t),o=0,s=r.length;o<s;o++)if(n=r[o],e(t[n],n,t))return n},C.pick=function(t,e,i){var n,r,o={},s=t;if(null==s)return o;C.isFunction(e)?(r=C.allKeys(s),n=x(e,i)):(r=V(arguments,!1,!1,1),n=function(t,e,i){return e in i},s=Object(s));for(var a=0,c=r.length;a<c;a++){var l=r[a],h=s[l];n(h,l,s)&&(o[l]=h)}return o},C.omit=function(t,e,i){if(C.isFunction(e))e=C.negate(e);else{var n=C.map(V(arguments,!1,!1,1),String);e=function(t,e){return!C.contains(n,e)}}return C.pick(t,e,i)},C.defaults=E(C.allKeys,!0),C.create=function(t,e){var i=M(t);return e&&C.extendOwn(i,e),i},C.clone=function(t){return C.isObject(t)?C.isArray(t)?t.slice():C.extend({},t):t},C.tap=function(t,e){return e(t),t},C.isMatch=function(t,e){var i=C.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),o=0;o<n;o++){var s=i[o];if(e[s]!==r[s]||!(s in r))return!1}return!0};var z=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof C&&(t=t._wrapped),e instanceof C&&(e=e._wrapped);var r=p.call(t);if(r!==p.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var o="[object Array]"===r;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(C.isFunction(s)&&s instanceof s&&C.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var c=i.length;c--;)if(i[c]===t)return n[c]===e;if(i.push(t),n.push(e),o){if(c=t.length,c!==e.length)return!1;for(;c--;)if(!z(t[c],e[c],i,n))return!1}else{var l,h=C.keys(t);if(c=h.length,C.keys(e).length!==c)return!1;for(;c--;)if(l=h[c],!C.has(e,l)||!z(t[l],e[l],i,n))return!1}return i.pop(),n.pop(),!0};C.isEqual=function(t,e){return z(t,e)},C.isEmpty=function(t){return null==t||(R(t)&&(C.isArray(t)||C.isString(t)||C.isArguments(t))?0===t.length:0===C.keys(t).length)},C.isElement=function(t){return!(!t||1!==t.nodeType)},C.isArray=v||function(t){return"[object Array]"===p.call(t)},C.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},C.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){C["is"+t]=function(e){return p.call(e)==="[object "+t+"]"}}),C.isArguments(arguments)||(C.isArguments=function(t){return C.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(C.isFunction=function(t){return"function"==typeof t||!1}),C.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},C.isNaN=function(t){return C.isNumber(t)&&t!==+t},C.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===p.call(t)},C.isNull=function(t){return null===t},C.isUndefined=function(t){return void 0===t},C.has=function(t,e){return null!=t&&g.call(t,e)},C.noConflict=function(){return c._=l,this},C.identity=function(t){return t},C.constant=function(t){return function(){return t}},C.noop=function(){},C.property=A,C.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},C.matcher=C.matches=function(t){return t=C.extendOwn({},t),function(e){return C.isMatch(e,t)}},C.times=function(t,e,i){var n=Array(Math.max(0,t));e=x(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n},C.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},C.now=Date.now||function(){return(new Date).getTime()};var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=C.invert(P),D=function(t){var e=function(e){return t[e]},i="(?:"+C.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};C.escape=D(P),C.unescape=D(j),C.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),C.isFunction(n)?n.call(t):n};var L=0;C.uniqueId=function(t){var e=++L+"";return t?t+e:e},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},$=/\\|'|\r|\n|\u2028|\u2029/g,N=function(t){return"\\"+H[t]};C.template=function(t,e,i){!e&&i&&(e=i),e=C.defaults({},e,C.templateSettings);var n=RegExp([(e.escape||U).source,(e.interpolate||U).source,(e.evaluate||U).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(n,function(e,i,n,s,a){return o+=t.slice(r,a).replace($,N),r=a+e.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,C)},c=e.variable||"obj";return a.source="function("+c+"){\n"+o+"}",a},C.chain=function(t){var e=C(t);return e._chain=!0,e};var q=function(t,e){return t._chain?C(e).chain():e};C.mixin=function(t){C.each(C.functions(t),function(e){var i=C[e]=t[e];C.prototype[e]=function(){var t=[this._wrapped];return f.apply(t,arguments),q(this,i.apply(C,t))}})},C.mixin(C),C.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=h[t];C.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],q(this,i)}}),C.each(["concat","join","slice"],function(t){var e=h[t];C.prototype[t]=function(){return q(this,e.apply(this._wrapped,arguments))}}),C.prototype.value=function(){return this._wrapped},C.prototype.valueOf=C.prototype.toJSON=C.prototype.value,C.prototype.toString=function(){return""+this._wrapped},n=[],r=function(){return C}.apply(e,n),!(void 0!==r&&(t.exports=r))}).call(this)},function(t,e,i){var n,r;(function(o){!function(s){var a="object"==typeof self&&self.self===self&&self||"object"==typeof o&&o.global===o&&o;n=[i(2),i(1),e],r=function(t,e,i){a.Backbone=s(a,i,t,e)}.apply(e,n),!(void 0!==r&&(t.exports=r))}(function(t,e,i,n){var r=t.Backbone,o=Array.prototype.slice;e.VERSION="1.3.3",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s=function(t,e,n){switch(t){case 1:return function(){return i[e](this[n])};case 2:return function(t){return i[e](this[n],t)};case 3:return function(t,r){return i[e](this[n],c(t,this),r)};case 4:return function(t,r,o){return i[e](this[n],c(t,this),r,o)};default:return function(){var t=o.call(arguments);return t.unshift(this[n]),i[e].apply(i,t)}}},a=function(t,e,n){i.each(e,function(e,r){i[r]&&(t.prototype[r]=s(e,r,n))})},c=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?l(t):i.isString(t)?function(e){return e.get(t)}:t},l=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}},h=e.Events={},u=/\s+/,d=function(t,e,n,r,o){var s,a=0;if(n&&"object"==typeof n){void 0!==r&&"context"in o&&void 0===o.context&&(o.context=r);for(s=i.keys(n);a<s.length;a++)e=d(t,e,s[a],n[s[a]],o)}else if(n&&u.test(n))for(s=n.split(u);a<s.length;a++)e=t(e,s[a],r,o);else e=t(e,n,r,o);return e};h.on=function(t,e,i){return f(this,t,e,i)};var f=function(t,e,i,n,r){if(t._events=d(m,t._events||{},e,i,{context:n,ctx:t,listening:r}),r){var o=t._listeners||(t._listeners={});o[r.id]=r}return t};h.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),s=o[r];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=o[r]={obj:t,objId:r,id:a,listeningTo:o,count:0}}return f(t,e,n,this,s),this};var m=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),o=n.context,s=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:o,ctx:o||s,listening:a})}return t};h.off=function(t,e,i){return this._events?(this._events=d(p,this._events,t,e,{context:i,listeners:this._listeners}),this):this},h.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var o=t?[t._listenId]:i.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(e,n,this)}return this};var p=function(t,e,n,r){if(t){var o,s=0,a=r.context,c=r.listeners;if(e||n||a){for(var l=e?[e]:i.keys(t);s<l.length;s++){e=l[s];var h=t[e];if(!h)break;for(var u=[],d=0;d<h.length;d++){var f=h[d];n&&n!==f.callback&&n!==f.callback._callback||a&&a!==f.context?u.push(f):(o=f.listening,o&&0===--o.count&&(delete c[o.id],delete o.listeningTo[o.objId]))}u.length?t[e]=u:delete t[e]}return t}for(var m=i.keys(c);s<m.length;s++)o=c[m[s]],delete c[o.id],delete o.listeningTo[o.objId]}};h.once=function(t,e,n){var r=d(g,{},t,e,i.bind(this.off,this));return"string"==typeof t&&null==n&&(e=void 0),this.on(r,e,n)},h.listenToOnce=function(t,e,n){var r=d(g,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,r)};var g=function(t,e,n,r){if(n){var o=t[e]=i.once(function(){r(e,o),n.apply(this,arguments)});o._callback=n}return t};h.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return d(v,this._events,t,void 0,i),this};var v=function(t,e,i,n){if(t){var r=t[e],o=t.all;r&&o&&(o=o.slice()),r&&_(r,n),o&&_(o,[e].concat(n))}return t},_=function(t,e){var i,n=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}};h.bind=h.on,h.unbind=h.off,i.extend(e,h);var y=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var r=i.result(this,"defaults");n=i.defaults(i.extend({},r,n),r),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){if(null==t)return this;var r;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var o=n.unset,s=n.silent,a=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={});var l=this.attributes,h=this.changed,u=this._previousAttributes;for(var d in r)e=r[d],i.isEqual(l[d],e)||a.push(d),i.isEqual(u[d],e)?delete h[d]:h[d]=e,o?delete l[d]:l[d]=e;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(var f=0;f<a.length;f++)this.trigger("change:"+a[f],this,l[a[f]],n)}if(c)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var r in t){var o=t[r];i.isEqual(e[r],o)||(n[r]=o)}return!!i.size(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,n=t.success;return t.success=function(i){var r=t.parse?e.parse(i,t):i;return!!e.set(r,t)&&(n&&n.call(t.context,e,i,t),void e.trigger("sync",e,i,t))},U(this,t),this.sync("read",this,t)},save:function(t,e,n){var r;null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0,parse:!0},n);var o=n.wait;if(r&&!o){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;var s=this,a=n.success,c=this.attributes;n.success=function(t){s.attributes=c;var e=n.parse?s.parse(t,n):t;return o&&(e=i.extend({},r,e)),!(e&&!s.set(e,n))&&(a&&a.call(n.context,s,t,n),void s.trigger("sync",s,t,n))},U(this,n),r&&o&&(this.attributes=i.extend({},c,r));var l=this.isNew()?"create":n.patch?"patch":"update";"patch"!==l||n.attrs||(n.attrs=r);var h=this.sync(l,this,n);return this.attributes=c,h},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=t.wait,o=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){r&&o(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var s=!1;return this.isNew()?i.defer(t.success):(U(this,t),s=this.sync("delete",this,t)),r||o(),s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||L();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};a(y,w,"attributes");var b=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},C={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},k=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,r=Array(t.length-i),o=e.length;for(n=0;n<r.length;n++)r[n]=t[n+i];for(n=0;n<o;n++)t[n+i]=e[n];for(n=0;n<r.length;n++)t[n+o+i]=r[n]};i.extend(b.prototype,h,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,x))},remove:function(t,e){e=i.extend({},e);var n=!i.isArray(t);t=n?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),n?r[0]:r},set:function(t,e){if(null!=t){e=i.extend({},C,e),e.parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var n=!i.isArray(t);t=n?[t]:t.slice();var r=e.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var o,s,a=[],c=[],l=[],h=[],u={},d=e.add,f=e.merge,m=e.remove,p=!1,g=this.comparator&&null==r&&e.sort!==!1,v=i.isString(this.comparator)?this.comparator:null;for(s=0;s<t.length;s++){o=t[s];var _=this.get(o);if(_){if(f&&o!==_){var y=this._isModel(o)?o.attributes:o;e.parse&&(y=_.parse(y,e)),_.set(y,e),l.push(_),g&&!p&&(p=_.hasChanged(v))}u[_.cid]||(u[_.cid]=!0,a.push(_)),t[s]=_}else d&&(o=t[s]=this._prepareModel(o,e),o&&(c.push(o),this._addReference(o,e),u[o.cid]=!0,a.push(o)))}if(m){for(s=0;s<this.length;s++)o=this.models[s],u[o.cid]||h.push(o);h.length&&this._removeModels(h,e)}var w=!1,b=!g&&d&&m;if(a.length&&b?(w=this.length!==a.length||i.some(this.models,function(t,e){return t!==a[e]}),this.models.length=0,k(this.models,a,0),this.length=this.models.length):c.length&&(g&&(p=!0),k(this.models,c,null==r?this.length:r),this.length=this.models.length),p&&this.sort({silent:!0}),!e.silent){for(s=0;s<c.length;s++)null!=r&&(e.index=r+s),o=c[s],o.trigger("add",o,this,e);(p||w)&&this.trigger("sort",this,e),(c.length||h.length||l.length)&&(e.changes={added:c,removed:h,merged:l},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return i.isFunction(e)&&(e=i.bind(e,this)),1===n||i.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){t=i.extend({parse:!0},t);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},U(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var n=e.wait;if(t=this._prepareModel(t,e),!t)return!1;n||this.add(t,e);var r=this,o=e.success;return e.success=function(t,e,i){n&&r.add(t,i),o&&o.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var r=this.get(t[n]);if(r){var o=this.indexOf(r);this.models.splice(o,1),this.length--,delete this._byId[r.cid];var s=this.modelId(r.attributes);null!=s&&delete this._byId[s],e.silent||(e.index=o,r.trigger("remove",r,this,e)),i.push(r),this._removeReference(r,e)}}return i},_isModel:function(t){return t instanceof y},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),o=this.modelId(e.attributes);r!==o&&(null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=e))}}this.trigger.apply(this,arguments)}});var E={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};a(b,E,"models");var M=e.View=function(t){this.cid=i.uniqueId("view"),i.extend(this,i.pick(t,S)),this._ensureElement(),this.initialize.apply(this,arguments)},A=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];i.extend(M.prototype,h,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[n]),n){var r=e.match(A);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,n,r){var o=O[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||L()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var c=r.error;r.error=function(t,e,i){r.textStatus=e,r.errorThrown=i,c&&c.call(r.context,t,e,i)};var l=r.xhr=e.ajax(i.extend(s,r));return n.trigger("request",n,l,r),l};var O={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var R=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},I=/\((.*?)\)/g,V=/(\(\?)?:\w+/g,T=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(R.prototype,h,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return e.history.route(t,function(i){var s=o._extractParameters(t,i);o.execute(r,s,n)!==!1&&(o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),e.history.trigger("route",o,n,s))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(F,"\\$&").replace(I,"(?:$1)?").replace(V,function(t,e){return e?t:"([^/?]+)"}).replace(T,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var B=e.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},z=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,j=/#.*$/;B.started=!1,i.extend(B.prototype,h,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(z,"")},start:function(t){if(B.started)throw new Error("Backbone.history has already been started");if(B.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(P,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,r=n.insertBefore(this.iframe,n.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),B.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!B.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(j,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new B;var D=function(t,e){var n,r=this;return n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e),n.prototype=i.create(r.prototype,t),n.prototype.constructor=n,n.__super__=r.prototype,n};y.extend=b.extend=R.extend=M.extend=B.extend=D;var L=function(){throw new Error('A "url" property or function must be specified')},U=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e})}).call(e,function(){return this}())},function(t,e){t.exports={initCitations:function(t){var e,i=document.getElementById("entry-footnotes"),n=document.getElementById("entry-footnotes-header"),r=document.getElementById("entry-footnotes-content"),o=document.getElementById("entry-content__citation-popup"),s=document.getElementById("entry-content__citation-id"),a=document.getElementById("entry-content__citation-text"),c=document.getElementById("entry-content__citation-close");c.addEventListener("click",function(){o.classList.remove("active")}),t.forEach(function(c,l){var h=document.createElement("p");h.innerText+=c.dataset.footnoteIndex,h.innerText+=": ",h.innerText+=c.dataset.footnote,r.append(h),c.addEventListener("click",function(){s.innerText=c.dataset.footnoteIndex,a.innerText=c.dataset.footnote,o.classList.toggle("active")}),l===t.length-1&&(e=r.clientHeight,n.addEventListener("click",function(){i.classList.toggle("active"),i.classList.contains("active")?r.style.height=e+"px":r.style.height=0}))})}}},function(t,e,i){var n=i(1),r=i(2),o=window.tor_wp_vars;window.location.hash.match(/#comment-(\d+)/)&&(o.comment_autoload_disabled=!1,n("#load-comments-autoload-disabled").hide(),n("#newest-comment-link").show()),t.exports={loadComments:function(t){var e=window.location.hash;if(r.isUndefined(t)&&"#comment-newest"!=e){t=parseInt(n("#comment-page").val());var e=!1}var i=this,s=parseInt(n("#total-comment-pages").val());n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"get_comments",post_id:o.post_id,cpage:t,nonce:n("#comment-nonce").val()},dataType:"html"}).done(function(t){if(r.isUndefined(t)||"-1"!==t){if(!r.isUndefined(t)){var a=n(t);i.setFlaggedComments(a),o.is_user_logged_in||n("#comments").trigger("comments-loaded",a),n("#comment-container").append(a);var c=parseInt(n("#comment-page").val())+1;if(n("#comment-page").val(c),e.length){"#comment-newest"==e&&(e=n("#newest-comment-link").attr("href"));var l=n("#comments").find(e);l.length?(n(".infinite-loader").remove(),n("#comment-container").show(),n("#comment-form-wrapper").show(),n("#comment-more-buttons").show(),n("html, body").animate({scrollTop:l.offset().top},50)):c<=s&&i.loadComments(parseInt(c))}i.showCommentBookmark(),n(".comment-text a").each(function(){var t=n(this).attr("href"),e=n(this).prop("href",t).prop("hostname");"//"+e!=o.site_domain&&n(this).attr("target","external-links-new-window")}),c>s?(c=s,n("#load-more-comments").hide(),n("#check-more-comments").show(),n(".latest-comment-message-container").hide()):(n("#load-more-comments").removeClass("disabled").show(),n("#check-more-comments").hide())}}else n("#comment-container").html(o.comment_messages.session_expired)})},updateCharCounter:function(t,e){var i=o.comment_char_limit.text+": "+e+" / "+o.comment_char_limit.char_limit;e>=o.comment_char_limit.char_limit&&(i='<span style="font-weight:bold; color: #f00;">'+i+"</span>"),n(".comment-notes-after","#commentform").html(i)},resetCharCounter:function(){this.updateCharCounter(!1,0)},getContentLength:function(){return tinymce.get(tinymce.activeEditor.id).contentDocument.body.innerText.length},addCharCounterUi:function(){var t=o.comment_char_limit.char_limit,e='<p class="comment-notes-after">Character Count: 0 / '+t+"</p>";n("#comment").after(e)},loadCommentForm:function(t){var e=this;tinyMCE.baseURL=o.static_url+"tinymce/",tinyMCE.init({menubar:!1,mode:"exact",max_chars:o.comment_char_limit.char_limit,elements:"comment",theme:"modern",content_css:o.static_url+"tinymce/customContentStyle.css",skin_url:o.static_url+"tinymce/skins/light",selector:"textarea",plugins:"desktop"===t?"textcolor image link paste":"textcolor paste",toolbar:"desktop"===t?"bold italic strikethrough underline | blockquote | forecolor backcolor | link unlink | image":"bold italic strikethrough underline | blockquote | forecolor backcolor",browser_spellcheck:!0,setup:function(t){var i=[8,37,38,39,40,46];t.on("change",function(){tinymce.triggerSave()}),t.on("keydown",function(t){return i.indexOf(t.keyCode)!=-1||(!(e.getContentLength()+1>this.settings.max_chars)||(t.preventDefault(),t.stopPropagation(),!1))}),t.on("keyup",function(t){e.updateCharCounter(this,e.getContentLength())})},init_instance_callback:e.addCharCounterUi(),paste_preprocess:function(t,i){var r=tinymce.activeEditor,s=r.contentDocument.body.innerText.length,a=-1===i.content.indexOf("<")?i.content:n(i.content).text();s+a.length>=r.settings.max_chars?(alert(o.comment_char_limit.paste_error),i.content=""):e.updateCharCounter(r,s+a.length)}})},setFlaggedComments:function(t){if(!o.is_moderator){var e=n.cookie("flagged_comments");r.isUndefined(e)||t.find(".article-comments-post").each(function(){var t=n(this),i=t.data("comment-id");e.indexOf(i)!==-1&&t.find(".comment-flag").html("Flagged").addClass("disabled")})}},initCommentFlagging:function(){var t=this;t.setFlaggedComments(n("#comments")),n("#comments").on("click",".unflag-comment",function(t){var e=n(this),i=e.parents(".article-comments-post").data("comment-id");n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"unflag_comment",comment_id:i,nonce:n("#comment-nonce").val()}}).done(function(){o.is_moderator&&(e.html("Flag"),e.removeClass("unflag-comment"),e.addClass("flag-comment"),e.parents(".article-comments-post").toggleClass("comment-flagged"))}),t.preventDefault()}),n("#comments").on("click",".flag-comment",function(t){var e=n(this),i=e.siblings(".comment-flag-reason");t.preventDefault(),e.hasClass("unflag-comment")||i.toggle()}),n("#comments").on("change",".comment-flag-reason",function(t){var e=n(this),i=e.val(),s=e.siblings(".flag-comment"),a=s.parents(".article-comments-post").data("comment-id");if(o.flag_default!=i){if(!o.is_moderator){var c=n.cookie("flagged_comments");if(r.isUndefined(c))n.cookie("flagged_comments",[a]);else{if(c.indexOf(a)!==-1)return;c.push(a),n.cookie("flagged_comments",c)}}n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"flag_comment",reason:e.val(),comment_id:a,flag:i,nonce:n("#comment-nonce").val()}}).done(function(){o.is_moderator?(s.html("Unflag"),s.addClass("unflag-comment"),s.removeClass("flag-comment"),s.parents(".article-comments-post").toggleClass("comment-flagged")):(s.html("Flagged"),s.addClass("disabled")),e.hide()}),t.preventDefault()}})},editComment:function(){n("#comments").on("click",".comment-edit-user",function(t){n("#comment-form-message").html(""),n("#comment-form-title").html(o.comment_title_text.edit);var e=n(this),i=n("#commentform"),r=e.data("comment-id");n("#commentid").val(r),n("#submit").hide(),n("#update-comment").show(),n("#cancel-comment").show(),tinymce.get("comment").setContent(n("#comment-text-"+r).html()),n(document).scrollTop(i.offset().top),t.preventDefault()})},toggleCommentStatus:function(){n("#comments").on("click",".comment-toggle-status",function(t){var e,i=n(this),r=i.data("comment-id"),s=i.data("comment-status");e=1==parseInt(s)?"0":"1",n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"approve_comment",commentid:r,status:e,nonce:n("#comment-nonce").val()}}).done(function(){i.data("comment-status",parseInt(e)),1===parseInt(e)?(i.html("Unapprove"),n("#comment-container-"+r).addClass("comment-approved"),n("#comment-container-"+r).removeClass("comment-unapproved")):(i.html("Approve"),n("#comment-container-"+r).addClass("comment-unapproved"),n("#comment-container-"+r).removeClass("comment-approved"))}),t.preventDefault()})},updateComment:function(){var t=this;n("#comments").on("click","#update-comment",function(e){n("#comment-form-message").html("");var i=n("#commentid").val();n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"update_comment",commentid:i,valid:!0,comment:n("#comment").val(),nonce:n("#comment-nonce").val()}}).done(function(e){0===e?t.commentFormFeedback("update_error"):t.displayCommentSubmit(e,i)}),e.preventDefault()})},previewComment:function(){var t=this;n("#comments").on("click","#preview",function(e){t.validCommentFields()&&(t.styleReset(),t.showPreview(),n("#preview-title").show(),n("#comment-form-wrapper").addClass("preview"),n("#preview-message").html(o.comment_messages.preview),t.setPreviewDate(),e.preventDefault())})},setPreviewDate:function(){n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"get_current_date",nonce:n("#comment-nonce").val()}}).done(function(t){n("#preview-date").html(t)})},showPreview:function(){n(".comment-preview").show(),n("#cancel-comment").show(),n("#update-comment").is(":visible")?n("#submit").hide():(n("#submit").show(),n("#submit").val(o.comment_button_text.submit)),n("#preview-text").html(n("#comment").val()),n("#preview-text a").on("click",function(t){t.preventDefault(),window.open(n(this).attr("href"))}),parseInt(o.current_user)||n("#preview-author").html(n("#author").val())},cancelComment:function(){var t=this;n("#comments").on("click","#cancel-comment",function(e){n("#update-comment").hide(),t.formReset(),e.preventDefault()})},formReset:function(){var t=this;tinymce.get("comment").setContent(""),n("#comment").val(""),n("#commentid").val(""),n("#comment-form-title").html(o.comment_title_text.post),t.resetCharCounter(),t.styleReset()},styleReset:function(){var t=this;n("#comment-form-message").html(""),n("#comment-form-wrapper").removeClass("preview"),n("#comment-preview-wrapper").removeClass("moderated"),n(".comment-preview").hide(),t.buttonReset()},buttonReset:function(){n("#update-comment").is(":visible")?n("#submit").hide():(parseInt(o.current_user)?(n("#submit").show(),n("#submit").val(o.comment_button_text.quick)):(n("#submit").val(o.comment_button_text.submit),n("#submit").hide()),n("#update-comment").hide()),n("#cancel-comment").hide()},displayCommentSubmit:function(t,e){var i=this;"force-review"===t.trim()?(i.showPreview(),i.setPreviewDate(),n("#comment-preview-wrapper").addClass("moderated"),n("#preview-title").hide(),n("#moderation-message").hide(),n("#preview-message").html(o.comment_messages.moderation)):"blacklisted-content"===t.trim()?(i.showPreview(),i.setPreviewDate(),n("#comment-preview-wrapper").addClass("moderated"),n("#preview-title").hide(),n("#preview-message").html(o.comment_messages.blacklist)):"banned"===t.trim()?(i.showPreview(),i.setPreviewDate(),n("#comment-preview-wrapper").addClass("moderated"),n("#preview-title").hide(),n("#preview-message").html(o.comment_messages.banned),r.isUndefined(n.cookie("hide_comment_form"))&&n.cookie("hide_comment_form",!0,{expires:9999}),n("#commentform").hide(),n("#comment-form-title").hide()):"success"===t.trim()?n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"validate_comment_load",comment_id:e,nonce:n("#comment-nonce").val()},dataType:"json"}).done(function(t){t.comment_cache_cleared?(n("#total-comment-pages").val(t.comment_pages),n("#newest-comment-link").attr("href","#comment-"+e),n("#comment-page").val(1),n("#comments-title").html(t.comment_count_header),!1===o.comment_autoload_disabled?(r.isUndefined(e)?window.location.hash="#comment-newest":window.location.hash="#comment-"+e,n("#comment-container").hide(),n("#comment-container").html(""),n("#comment-more-buttons").hide(),i.loadComments(1),n("#comment-container").after('<span class="infinite-loader"></span>')):i.commentFormFeedback("comment_submitted")):(window.location.hash="#comment-newest",window.location.reload(!0))}):(window.location.hash="#comment-newest",window.location.reload(!0)),n("#comment").val(""),tinymce.get("comment").setContent(""),i.resetCharCounter(),i.buttonReset()},skipLinks:function(){var t=this;n(".comment-skip-link").on("click",function(e){window.location.hash=n(this).attr("href"),t.loadComments(parseInt(n("#comment-page").val()))})},trackComments:function(){var t=this;n(".article-comments-post").appear();var e="last_comment_viewed_post_"+o.post_id.toString();r.isUndefined(n.cookie(e))||(t.setLatestLink(n.cookie(e)),t.showCommentBookmark()),n("#comment-container").on("appear",".article-comments-post",function(i,o){o.each(function(){(r.isUndefined(n.cookie(e))||parseInt(n.cookie(e))<parseInt(n(this).data("comment-id")))&&(n.cookie(e,n(this).data("comment-id"),{expires:30}),t.setLatestLink(n(this).data("comment-id")))})})},setLatestLink:function(t){if(!r.isUndefined(t)){var e=n("#latest-comment-link");e.show(),e.attr("href","#comment-"+t.toString())}},showCommentBookmark:function(){var t="last_comment_viewed_post_"+o.post_id.toString();if(!r.isUndefined(n.cookie(t))){var e=n("#comment-bookmark-found"),i=n("#latest-comment-message-container-"+n.cookie(t).toString());"false"===e.val()&&i.length&&(n(".latest-comment-message-container").hide(),i.show(),e.val("true"))}},initSubscribeComments:function(){n(".show-subcribe-form").on("click",function(t){n("#subscribe-form-response").hide(),n(".subscribe-form-wrapper").show(),t.preventDefault()}),n("#subscribe-cancel").on("click",function(t){n(".subscribe-form-wrapper").hide(),n("#subscribe-form-response").hide(),t.preventDefault()}),n("#subscribe-submit").on("click",function(t){var e=n(this),i=n("input[name=subscribe-type]:checked").val();n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"comment_subscribe",user_id:e.data("user_id"),post_id:e.data("post_id"),subscribe_type:i,nonce:e.data("nonce")}}).done(function(t){t&&(n(".subscribe-form-wrapper").hide(),n("#subscribe-form-response").show())}),t.preventDefault()}),n("#subscribe-register").on("click",function(t){window.location="/register/",t.preventDefault()})},initCommentBans:function(){n("#comments").on("click",".ban-comment",function(t){var e=n(this),i=e.siblings(".comment-ban-type");t.preventDefault(),e.hasClass("unban-comment")||i.toggle()}),n("#comments").on("change",".comment-ban-type",function(t){if(o.is_moderator){var e=n(this),i=e.val(),r=e.siblings(".ban-comment"),s=r.parents(".article-comments-post").data("comment-id");n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"ban_comment",type:i,comment_id:s,nonce:n("#comment-nonce").val()}}).done(function(t){o.is_moderator&&0!=parseInt(t)&&(r.html('<a href="'+o.wp_edit_post+"?action=edit&post="+t+'" class="unban-comment">Banned</a>'),r.addClass("unban-comment"),r.removeClass("ban-comment"),r.parents(".article-comments-post").toggleClass("comment-banned")),e.hide()})}t.preventDefault()})},initCommenting:function(t){if(o.post_id&&o.comments_enabled){var e=this;n("#commentform");n("#comment-page").val(1),n(window).load(function(){o.comment_autoload_disabled||e.loadComments(parseInt(n("#comment-page").val())),!o.comments_protected&&o.allow_new_comments&&e.loadCommentForm(t),e.initCommentFlagging(),e.initCommentBans(),e.editComment(),e.updateComment(),e.cancelComment(),e.previewComment(),e.toggleCommentStatus(),o.comment_autoload_disabled||(e.skipLinks(),e.trackComments()),e.initSubscribeComments()}),n("#load-comments-autoload-disabled").on("click",function(t){$el=n(this),$el.not(".disabled")&&($el.addClass("disabled"),e.loadComments(),e.skipLinks(),e.trackComments(),n("#newest-comment-link").show()),t.preventDefault()}),n("#load-more-comments").on("click",function(t){$el=n(this),$el.hasClass("disabled")||($el.addClass("disabled"),e.loadComments()),t.preventDefault()}),n("#check-more-comments").on("click",function(t){var e=n("#latest-comment-link"),i=e.attr("href");r.isUndefined(i)&&(i="comments"),window.location.hash=i,window.location.reload(!0),t.preventDefault()}),r.isUndefined(n.cookie("hide_comment_form"))?n("#comments:not(.disabled)").on("click","#submit",function(t){var i=n(this);if(i.addClass("disabled"),!e.validCommentFields())return void i.removeClass("disabled");e.styleReset();var r=n("#commentform"),s=r.serialize();return n("#comment-form-message").html(""),o.is_user_logged_in?(s+="&valid="+encodeURIComponent(o.is_user_logged_in),e.submitCommentAjax(s)):n.ajax({type:"POST",url:o.wp_ajax_url,data:{action:"validate_recaptcha",response:grecaptcha.getResponse()},dataType:"json"}).done(function(t){t.success?(s+="&valid="+encodeURIComponent(t.success),e.submitCommentAjax(s)):e.commentFormFeedback("empty_recaptcha"),grecaptcha.reset()}),i.removeClass("disabled"),t.preventDefault(),!1}):n("#comment-form").hide()}},commentFormFeedback:function(t){o.comment_messages[t]&&n("#comment-form-message").html(o.comment_messages[t])},validCommentFields:function(){return o.is_user_logged_in||""!==n("#author").val().trim()&&""!==n("#email").val().trim()?""!==n("#comment").val().trim()||(this.commentFormFeedback("empty_comment"),!1):(this.commentFormFeedback("empty_name_email"),!1)},submitCommentAjax:function(t){var e=this;n.ajax({type:"POST",url:o.comment_submit_url,data:t,statusCode:{409:function(){e.commentFormFeedback("duplicate_comment")}}}).done(function(t){var i=jQuery.parseJSON(t);e.displayCommentSubmit(i.status,i.comment_id)})}}},function(t,e){t.exports={init:function(){if(!this.readCookie("privacy_viewed")){var t=this,e=document.getElementById("entry-content__footer-popup"),i=e.querySelector(".icon-cancel"),n=Array.prototype.slice.call(e.querySelectorAll("a"));e.classList.add("active"),window.setTimeout(function(){t.hidePopup(),t.createPrivacyCookie()},1e4),i.addEventListener("click",function(){t.hidePopup(),t.createPrivacyCookie()}),n.forEach(function(e){e.addEventListener("click",function(){t.hidePopup(),t.createPrivacyCookie()})})}},hidePopup:function(){var t=document.getElementById("entry-content__footer-popup");t.classList.remove("active")},createPrivacyCookie:function(){this.createCookie("privacy_viewed","true",365)},createCookie:function(t,e,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),n="; expires="+r.toUTCString()}document.cookie=t+"="+e+n+"; path=/"},readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return null}}},function(t,e,i){var n=i(11),r=i(1),o=function(){var t=this,e=t.$el.find(".controls"),i=t.$el.find(".errors"),n=t.$el.find(".page-selector"),o=function(e){var i=r(this);e.preventDefault(),i.hasClass("disabled")||(i.hasClass("back")?t.previousSlide():i.hasClass("next")&&t.nextSlide())};e.on("click",o),t.$el.find(".post-gallery-image").on("click",function(i){var n=e.find(".next");i.preventDefault(),n.hasClass("disabled")||t.nextSlide()}),t.listenTo(t,"slideChanged",function(){e.removeClass("disabled")}),t.listenTo(t,"firstSlide",function(){e.filter(".back").addClass("disabled")}),t.listenTo(t,"lastSlide",function(){e.filter(".next").addClass("disabled")}),n.length>0&&(t.listenTo(t,"slideChanged",function(t){n.val(t+1)}),n.on("change",function(){var e=this,n=e.value-1;/^\d+$/.test(n)?t.changeSlide(n)?(t.changeSlide(n),i.text("")):i.text("Invalid slide index"):i.text("Invalid input")}))};t.exports=function(t,e){var i=n.extend({el:t.el,slides:t.slides,initialize:o});return new i(e)}},function(t,e,i){var n=(i(1),i(36)),r=n.LayoutView.extend({el:"body",initialize:function(){var t=this;t.undelegateEvents()},activate:function(){var t=this;t.delegateEvents()},deactivate:function(){var t=this;t.undelegateEvents()}});t.exports=r},function(t,e){},function(t,e,i){var n;/*! picturefill - v3.0.2 - 2016-02-12
* https://scottjehl.github.io/picturefill/
* Copyright (c) 2016 https://github.com/scottjehl/picturefill/blob/master/Authors.txt; Licensed MIT
*//*! Gecko-Picture - v1.0
* https://github.com/scottjehl/picturefill/tree/3.0/src/plugins/gecko-picture
* Firefox's early picture implementation (prior to FF41) is static and does
* not react to viewport changes. This tiny module fixes this.
*/!function(t){var e=navigator.userAgent;t.HTMLPictureElement&&/ecko/.test(e)&&e.match(/rv\:(\d+)/)&&RegExp.$1<45&&addEventListener("resize",function(){var e,i=document.createElement("source"),n=function(t){var e,n,r=t.parentNode;"PICTURE"===r.nodeName.toUpperCase()?(e=i.cloneNode(),r.insertBefore(e,r.firstElementChild),setTimeout(function(){r.removeChild(e)})):(!t._pfLastSize||t.offsetWidth>t._pfLastSize)&&(t._pfLastSize=t.offsetWidth,n=t.sizes,t.sizes+=",100vw",setTimeout(function(){t.sizes=n}))},r=function(){var t,e=document.querySelectorAll("picture > img, img[srcset][sizes]");for(t=0;t<e.length;t++)n(e[t])},o=function(){clearTimeout(e),e=setTimeout(r,99)},s=t.matchMedia&&matchMedia("(orientation: landscape)"),a=function(){o(),s&&s.addListener&&s.addListener(o)};return i.srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",/^[c|i]|d$/.test(document.readyState||"")?a():document.addEventListener("DOMContentLoaded",a),o}())}(window),/*! Picturefill - v3.0.2
* http://scottjehl.github.io/picturefill
* Copyright (c) 2015 https://github.com/scottjehl/picturefill/blob/master/Authors.txt;
* License: MIT
*/function(r,o,s){"use strict";function a(t){return" "===t||"\t"===t||"\n"===t||"\f"===t||"\r"===t}function c(t,e){var i=new r.Image;return i.onerror=function(){R[t]=!1,ot()},i.onload=function(){R[t]=1===i.width,ot()},i.src=e,"pending"}function l(){H=!1,q=r.devicePixelRatio,$={},N={},C.DPR=q||1,W.width=Math.max(r.innerWidth||0,O.clientWidth),W.height=Math.max(r.innerHeight||0,O.clientHeight),W.vw=W.width/100,W.vh=W.height/100,b=[W.height,W.width,q].join("-"),W.em=C.getEmValue(),W.rem=W.em}function h(t,e,i,n){var r,o,s,a;return"saveData"===I.algorithm?t>2.7?a=i+1:(o=e-i,r=Math.pow(t-.6,1.5),s=o*r,n&&(s+=.1*r),a=t+s):a=i>1?Math.sqrt(t*e):t,a>i}function u(t){var e,i=C.getSet(t),n=!1;"pending"!==i&&(n=b,i&&(e=C.setRes(i),C.applySetCandidate(e,t))),t[C.ns].evaled=n}function d(t,e){return t.res-e.res}function f(t,e,i){var n;return!i&&e&&(i=t[C.ns].sets,i=i&&i[i.length-1]),n=m(e,i),n&&(e=C.makeUrl(e),t[C.ns].curSrc=e,t[C.ns].curCan=n,n.res||rt(n,n.set.sizes)),n}function m(t,e){var i,n,r;if(t&&e)for(r=C.parseSet(e),t=C.makeUrl(t),i=0;i<r.length;i++)if(t===C.makeUrl(r[i].url)){n=r[i];break}return n}function p(t,e){var i,n,r,o,s=t.getElementsByTagName("source");for(i=0,n=s.length;i<n;i++)r=s[i],r[C.ns]=!0,o=r.getAttribute("srcset"),o&&e.push({srcset:o,media:r.getAttribute("media"),type:r.getAttribute("type"),sizes:r.getAttribute("sizes")})}function g(t,e){function i(e){var i,n=e.exec(t.substring(d));if(n)return i=n[0],d+=i.length,i}function n(){var t,i,n,r,a,c,l,h,u,d=!1,m={};for(r=0;r<s.length;r++)a=s[r],c=a[a.length-1],l=a.substring(0,a.length-1),h=parseInt(l,10),u=parseFloat(l),Z.test(l)&&"w"===c?((t||i)&&(d=!0),0===h?d=!0:t=h):tt.test(l)&&"x"===c?((t||i||n)&&(d=!0),u<0?d=!0:i=u):Z.test(l)&&"h"===c?((n||i)&&(d=!0),0===h?d=!0:n=h):d=!0;d||(m.url=o,t&&(m.w=t),i&&(m.d=i),n&&(m.h=n),n||i||t||(m.d=1),1===m.d&&(e.has1x=!0),m.set=e,f.push(m))}function r(){for(i(K),c="",l="in descriptor";;){if(h=t.charAt(d),"in descriptor"===l)if(a(h))c&&(s.push(c),c="",l="after descriptor");else{if(","===h)return d+=1,c&&s.push(c),void n();if("("===h)c+=h,l="in parens";else{if(""===h)return c&&s.push(c),void n();c+=h}}else if("in parens"===l)if(")"===h)c+=h,l="in descriptor";else{if(""===h)return s.push(c),void n();c+=h}else if("after descriptor"===l)if(a(h));else{if(""===h)return void n();l="in descriptor",d-=1}d+=1}}for(var o,s,c,l,h,u=t.length,d=0,f=[];;){if(i(Q),d>=u)return f;o=i(Y),s=[],","===o.slice(-1)?(o=o.replace(X,""),n()):r()}}function v(t){function e(t){function e(){r&&(o.push(r),r="")}function i(){o[0]&&(s.push(o),o=[])}for(var n,r="",o=[],s=[],c=0,l=0,h=!1;;){if(n=t.charAt(l),""===n)return e(),i(),s;if(h){if("*"===n&&"/"===t[l+1]){h=!1,l+=2,e();continue}l+=1}else{if(a(n)){if(t.charAt(l-1)&&a(t.charAt(l-1))||!r){l+=1;continue}if(0===c){e(),l+=1;continue}n=" "}else if("("===n)c+=1;else if(")"===n)c-=1;else{if(","===n){e(),i(),l+=1;continue}if("/"===n&&"*"===t.charAt(l+1)){h=!0,l+=2;continue}}r+=n,l+=1}}}function i(t){return!!(h.test(t)&&parseFloat(t)>=0)||(!!u.test(t)||("0"===t||"-0"===t||"+0"===t))}var n,r,o,s,c,l,h=/^(?:[+-]?[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?(?:ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmin|vmax|vw)$/i,u=/^calc\((?:[0-9a-z \.\+\-\*\/\(\)]+)\)$/i;for(r=e(t),o=r.length,n=0;n<o;n++)if(s=r[n],c=s[s.length-1],i(c)){if(l=c,s.pop(),0===s.length)return l;if(s=s.join(" "),C.matchesMedia(s))return l}return"100vw"}o.createElement("picture");var _,y,w,b,C={},x=!1,k=function(){},E=o.createElement("img"),M=E.getAttribute,A=E.setAttribute,S=E.removeAttribute,O=o.documentElement,R={},I={algorithm:""},V="data-pfsrc",T=V+"set",F=navigator.userAgent,B=/rident/.test(F)||/ecko/.test(F)&&F.match(/rv\:(\d+)/)&&RegExp.$1>35,z="currentSrc",P=/\s+\+?\d+(e\d+)?w/,j=/(\([^)]+\))?\s*(.+)/,D=r.picturefillCFG,L="position:absolute;left:0;visibility:hidden;display:block;padding:0;border:none;font-size:1em;width:1em;overflow:hidden;clip:rect(0px, 0px, 0px, 0px)",U="font-size:100%!important;",H=!0,$={},N={},q=r.devicePixelRatio,W={px:1,in:96},G=o.createElement("a"),J=!1,K=/^[ \t\n\r\u000c]+/,Q=/^[, \t\n\r\u000c]+/,Y=/^[^ \t\n\r\u000c]+/,X=/[,]+$/,Z=/^\d+$/,tt=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,et=function(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n||!1):t.attachEvent&&t.attachEvent("on"+e,i)},it=function(t){var e={};return function(i){return i in e||(e[i]=t(i)),e[i]}},nt=function(){var t=/^([\d\.]+)(em|vw|px)$/,e=function(){for(var t=arguments,e=0,i=t[0];++e in t;)i=i.replace(t[e],t[++e]);return i},i=it(function(t){return"return "+e((t||"").toLowerCase(),/\band\b/g,"&&",/,/g,"||",/min-([a-z-\s]+):/g,"e.$1>=",/max-([a-z-\s]+):/g,"e.$1<=",/calc([^)]+)/g,"($1)",/(\d+[\.]*[\d]*)([a-z]+)/g,"($1 * e.$2)",/^(?!(e.[a-z]|[0-9\.&=|><\+\-\*\(\)\/])).*/gi,"")+";"});return function(e,n){var r;if(!(e in $))if($[e]=!1,n&&(r=e.match(t)))$[e]=r[1]*W[r[2]];else try{$[e]=new Function("e",i(e))(W)}catch(t){}return $[e]}}(),rt=function(t,e){return t.w?(t.cWidth=C.calcListLength(e||"100vw"),t.res=t.w/t.cWidth):t.res=t.d,t},ot=function(t){if(x){var e,i,n,r=t||{};if(r.elements&&1===r.elements.nodeType&&("IMG"===r.elements.nodeName.toUpperCase()?r.elements=[r.elements]:(r.context=r.elements,r.elements=null)),e=r.elements||C.qsa(r.context||o,r.reevaluate||r.reselect?C.sel:C.selShort),n=e.length){for(C.setupRun(r),J=!0,i=0;i<n;i++)C.fillImg(e[i],r);C.teardownRun(r)}}};_=r.console&&console.warn?function(t){console.warn(t)}:k,z in E||(z="src"),R["image/jpeg"]=!0,R["image/gif"]=!0,R["image/png"]=!0,R["image/svg+xml"]=o.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"),C.ns=("pf"+(new Date).getTime()).substr(0,9),C.supSrcset="srcset"in E,C.supSizes="sizes"in E,C.supPicture=!!r.HTMLPictureElement,C.supSrcset&&C.supPicture&&!C.supSizes&&!function(t){E.srcset="data:,a",t.src="data:,a",C.supSrcset=E.complete===t.complete,C.supPicture=C.supSrcset&&C.supPicture}(o.createElement("img")),C.supSrcset&&!C.supSizes?!function(){var t="data:image/gif;base64,R0lGODlhAgABAPAAAP///wAAACH5BAAAAAAALAAAAAACAAEAAAICBAoAOw==",e="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",i=o.createElement("img"),n=function(){var t=i.width;2===t&&(C.supSizes=!0),w=C.supSrcset&&!C.supSizes,x=!0,setTimeout(ot)};i.onload=n,i.onerror=n,i.setAttribute("sizes","9px"),i.srcset=e+" 1w,"+t+" 9w",i.src=e}():x=!0,C.selShort="picture>img,img[srcset]",C.sel=C.selShort,C.cfg=I,C.DPR=q||1,C.u=W,C.types=R,C.setSize=k,C.makeUrl=it(function(t){return G.href=t,G.href}),C.qsa=function(t,e){return"querySelector"in t?t.querySelectorAll(e):[]},C.matchesMedia=function(){return r.matchMedia&&(matchMedia("(min-width: 0.1em)")||{}).matches?C.matchesMedia=function(t){return!t||matchMedia(t).matches}:C.matchesMedia=C.mMQ,C.matchesMedia.apply(this,arguments)},C.mMQ=function(t){return!t||nt(t)},C.calcLength=function(t){var e=nt(t,!0)||!1;return e<0&&(e=!1),e},C.supportsType=function(t){return!t||R[t]},C.parseSize=it(function(t){var e=(t||"").match(j);return{media:e&&e[1],length:e&&e[2]}}),C.parseSet=function(t){return t.cands||(t.cands=g(t.srcset,t)),t.cands},C.getEmValue=function(){var t;if(!y&&(t=o.body)){var e=o.createElement("div"),i=O.style.cssText,n=t.style.cssText;e.style.cssText=L,O.style.cssText=U,t.style.cssText=U,t.appendChild(e),y=e.offsetWidth,t.removeChild(e),y=parseFloat(y,10),O.style.cssText=i,t.style.cssText=n}return y||16},C.calcListLength=function(t){if(!(t in N)||I.uT){var e=C.calcLength(v(t));N[t]=e?e:W.width}return N[t]},C.setRes=function(t){var e;if(t){e=C.parseSet(t);for(var i=0,n=e.length;i<n;i++)rt(e[i],t.sizes)}return e},C.setRes.res=rt,C.applySetCandidate=function(t,e){if(t.length){var i,n,r,o,s,a,c,l,u,m=e[C.ns],p=C.DPR;if(a=m.curSrc||e[z],c=m.curCan||f(e,a,t[0].set),c&&c.set===t[0].set&&(u=B&&!e.complete&&c.res-.1>p,u||(c.cached=!0,c.res>=p&&(s=c))),!s)for(t.sort(d),o=t.length,s=t[o-1],n=0;n<o;n++)if(i=t[n],i.res>=p){r=n-1,s=t[r]&&(u||a!==C.makeUrl(i.url))&&h(t[r].res,i.res,p,t[r].cached)?t[r]:i;break}s&&(l=C.makeUrl(s.url),m.curSrc=l,m.curCan=s,l!==a&&C.setSrc(e,s),C.setSize(e))}},C.setSrc=function(t,e){var i;t.src=e.url,"image/svg+xml"===e.set.type&&(i=t.style.width,t.style.width=t.offsetWidth+1+"px",t.offsetWidth+1&&(t.style.width=i))},C.getSet=function(t){var e,i,n,r=!1,o=t[C.ns].sets;for(e=0;e<o.length&&!r;e++)if(i=o[e],i.srcset&&C.matchesMedia(i.media)&&(n=C.supportsType(i.type))){"pending"===n&&(i=n),r=i;break}return r},C.parseSets=function(t,e,i){var n,r,o,a,c=e&&"PICTURE"===e.nodeName.toUpperCase(),l=t[C.ns];(l.src===s||i.src)&&(l.src=M.call(t,"src"),l.src?A.call(t,V,l.src):S.call(t,V)),(l.srcset===s||i.srcset||!C.supSrcset||t.srcset)&&(n=M.call(t,"srcset"),l.srcset=n,a=!0),l.sets=[],c&&(l.pic=!0,p(e,l.sets)),l.srcset?(r={srcset:l.srcset,sizes:M.call(t,"sizes")},l.sets.push(r),o=(w||l.src)&&P.test(l.srcset||""),o||!l.src||m(l.src,r)||r.has1x||(r.srcset+=", "+l.src,r.cands.push({url:l.src,d:1,set:r}))):l.src&&l.sets.push({srcset:l.src,sizes:null}),l.curCan=null,l.curSrc=s,l.supported=!(c||r&&!C.supSrcset||o&&!C.supSizes),a&&C.supSrcset&&!l.supported&&(n?(A.call(t,T,n),t.srcset=""):S.call(t,T)),l.supported&&!l.srcset&&(!l.src&&t.src||t.src!==C.makeUrl(l.src))&&(null===l.src?t.removeAttribute("src"):t.src=l.src),l.parsed=!0},C.fillImg=function(t,e){var i,n=e.reselect||e.reevaluate;t[C.ns]||(t[C.ns]={}),i=t[C.ns],(n||i.evaled!==b)&&(i.parsed&&!e.reevaluate||C.parseSets(t,t.parentNode,e),i.supported?i.evaled=b:u(t))},C.setupRun=function(){J&&!H&&q===r.devicePixelRatio||l()},C.supPicture?(ot=k,C.fillImg=k):!function(){var t,e=r.attachEvent?/d$|^c/:/d$|^c|^i/,i=function(){var r=o.readyState||"";n=setTimeout(i,"loading"===r?200:999),o.body&&(C.fillImgs(),t=t||e.test(r),t&&clearTimeout(n))},n=setTimeout(i,o.body?9:99),s=function(t,e){var i,n,r=function(){var o=new Date-n;o<e?i=setTimeout(r,e-o):(i=null,t())};return function(){n=new Date,i||(i=setTimeout(r,e))}},a=O.clientHeight,c=function(){H=Math.max(r.innerWidth||0,O.clientWidth)!==W.width||O.clientHeight!==a,a=O.clientHeight,H&&C.fillImgs()};et(r,"resize",s(c,99)),et(o,"readystatechange",i)}(),C.picturefill=ot,C.fillImgs=ot,C.teardownRun=k,ot._=C,r.picturefillCFG={pf:C,push:function(t){var e=t.shift();"function"==typeof C[e]?C[e].apply(C,t):(I[e]=t[0],J&&C.fillImgs({reselect:!0}))}};for(;D&&D.length;)r.picturefillCFG.push(D.shift());r.picturefill=ot,"object"==typeof t&&"object"==typeof t.exports?t.exports=ot:(n=function(){return ot}.call(e,i,e,t),!(n!==s&&(t.exports=n))),C.supPicture||(R["image/webp"]=c("image/webp","data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="))}(window,document)},function(t,e,i){var n=i(1),r=i(3),o=i(2),s=function(t){var e=this;t||(t={}),e.state=new r.Model,o.extend(e,o.pick(t,a)),o.isString(e.el)?e.$el=n(e.el):o.isElement(e.el[0])&&(e.$el=e.el),o.bindAll(e,"nextSlide","previousSlide"),o.isElement(e.$el[0])&&e._initSlides(),e._initListeners(),e._hideSlides(),e._setSlideActive(0),o.isUndefined(t.autoplay)||t.autoplay!==!0||e._initAutoplay(),e.initialize.apply(e,arguments)},a=["el","slides","classes","loop"];s.extend=r.Model.extend,o.extend(s.prototype,r.Events,{initialize:function(){},_initSlides:function(){var t=this;o.isString(t.slides)&&(t.slides=t.$el.find(t.slides))},_initListeners:function(){var t=this;t.listenTo(t.state,"change:currentIndex",function(e,i){e.previous("currentIndex");t._hideSlides(),t._showSlide(i)})},_initAutoplay:function(){var t=this,e=t.slides.length;setInterval(function(){var i=t.getCurrentIndex();i===e-1?t._setSlideActive(0):t.nextSlide()},5e3)},_setSlideActive:function(t){var e=this,i=e.slides.length;return t>=0&&t<i&&(e.trigger("slideChanged",t),0===t?e.trigger("firstSlide"):t===i-1&&e.trigger("lastSlide"),e.state.set({currentIndex:t}),!0)},_showSlide:function(t){var e=this,i=e.slides.eq(t);i.removeClass("hide"),i.addClass("show")},changeSlide:function(t){var e=this;return e._setSlideActive(t)},hideSlide:function(t){var e=this,i=e.slides.eq(t);i.removeClass("show"),i.addClass("hide")},nextSlide:function(t){var e=this,i=e.getCurrentIndex();o.isUndefined(t)||t.preventDefault(),e._setSlideActive(i+1)},previousSlide:function(t){var e=this,i=e.getCurrentIndex();o.isUndefined(t)||t.preventDefault(),e._setSlideActive(i-1)},getCurrentIndex:function(){var t=this;return t.state.get("currentIndex")},getSlideCount:function(){var t=this;return t.slides.length},_hideSlides:function(){var t=this;t.slides.removeClass("show"),t.slides.addClass("hide")}}),t.exports=s},,,,function(t,e,i){var n=i(22),r=i(29),o=i(30),s=i(28),a=i(1),c=i(2),l=(i(3),i(10));a.cookie.json=!0,a(document.body).on("post-load",function(){c.isFunction(l)?l():window.picturefill()});var h=n.extend({breakpoints:tor_wp_vars.breakpoints,breakpointViews:{global:new r,mobile:new o,desktop:new s}});new h},function(t,e,i){var n=i(1);i(2);t.exports={initOnChangeListener:function(){var t=this;n("#sort, #term, #between").on("change",function(e){t.filterFormSubmit(),n("#filterform").submit(),t.disableFormFields(),e.preventDefault()}),n(document).ready(function(e){"newest"===e("#sort").val()&&t.showSearchForm()})},filterFormSubmit:function(){"author"!=n("#sort").val()&&"editor"!=n("#sort").val()&&(n("#filterform > p:first-of-type").hide(),n("#between").remove()),""===n("#filterform > #s").val()&&(n("#filterform > .search-submit").hide(),n("#filterform > #s").remove())},showSearchForm:function(){n("#filterform > .search-submit").removeClass("hidden"),n("#filterform > #s").removeClass("hidden")},disableFormFields:function(){n("#filterform").find("select","#s","button").attr("disabled","disabled")},initArchiveFilter:function(){var t=this;t.initOnChangeListener()}}},function(t,e,i){var n=i(1);i(2),window.tor_wp_vars;t.exports={init:function(){var t=n("#back-to-top"),e=n("article.post");if(t.length>0&&e.length>0){var i=e.offset().top+e.outerHeight()-n(window).height();t.on("click",function(t){t.preventDefault(),n("html, body").animate({scrollTop:0},1e3)}),n(document).scroll(function(){var e=n(this).scrollTop();e>i?t.fadeIn("fast"):t.fadeOut("fast")})}}}},function(t,e,i){var n=i(1),r=i(2);t.exports={initFavoriting:function(){var t=this;t.initFavoritesModal(),t.initFavoriteButton(),t.initPostFavoriteLinks(),r.isUndefined(tor_wp_vars.series)||t.initSeriesFavoriteLinks(),n("#comments").on("comments-loaded",function(e,i){t.setFavoritedComments(n(i))}),n(".profile-unfavorite").on("click",function(t){n(this).parent(".activity-archive-item").hide()}),n(document.body).on("post-load",function(){t.initPostFavoriteLinks(),t.initFavoritesModal()})},initPostFavoriteLinks:function(){var t=this,e=n("#content article.single, .home #content article.post, .home #content article.sweepstakes, .series-container article.post, #content.category article.category-series, #content.series article.post, #content.series article.series, body.author article.post");n.each(e,function(e,i){var o=n(i),s=r.isUndefined(o.data("type"))?"post":o.data("type"),a=o.data(s+"-id");tor_wp_vars.is_user_logged_in||o.hasClass("favorite-link-loaded")||(t.setFavoriteStatus(n("a#favorite-"+a),s),o.addClass("favorite-link-loaded")),1===o.find(".footer-favorite-wrapper").length&&"comment"!=s&&n("#favorite-"+a).clone(!0).attr("id","favorite-"+a+"-btm").appendTo(".footer-favorite-wrapper")})},initSeriesFavoriteLinks:function(){var t=this,e="series",i=tor_wp_vars.series.series_id;tor_wp_vars.is_user_logged_in||t.setFavoriteStatus(n("a#favorite-"+i),e)},initFavoriteButton:function(){var t=this;n("body").on("click",".favorite-link, .unfavorite-link, .profile-unfavorite",function(e){var i=n(this),r=i.data("entity-id"),o=i.data("user-id"),s=i.data("type"),a=i.data("nonce"),c=i.data("favorite-action");e.preventDefault(),i.hasClass("clicked")||(i.addClass("clicked"),t.updateFavoriteState(s,r,c,a,o))})},updateFavoriteState:function(t,e,i,o,s){var a=this,c=r.isUndefined(n.cookie("favorited-items"))?[]:n.cookie("favorited-items"),l=c.indexOf(e+"-"+t);(!r.isUndefined(s)&&0!=s||"favorite"===i&&l===-1||"unfavorite"===i&&l>-1)&&n.ajax({type:"POST",url:tor_wp_vars.wp_ajax_url,data:{action:"update_favorite_state",type:t,nonce:o,entity_id:e,user_id:s,favorite_action:i}}).done(function(r){r&&("favorite"===i?c.push(e+"-"+t):c.splice(l,1),n.cookie("favorited-items",c,{path:"/"}),a.updateFavoriteLink(t,e,i,r),n.modal.close())})},updateFavoriteLink:function(t,e,i,r){var o=null,s=n(".meta-favorite-link"),a="";"post"===t?o=n("#content").find(".post-favorite-count").filter(function(){return n(this).data("entity-id")===e}):"comment"===t?o=n("#comments").find(".comment-favorites a").filter(function(){return n(this).data("entity-id")===e}):"series"===t&&(o=n(".series-favorite-count, .series-favorite .series-favorite-count").filter(function(){return n(this).data("entity-id")===e})),0==r?(a="Favorite This",o.data("favorite-action","favorite"),"comment"!==t&&n(".post-favorite-meta").html("")):"favorite"===i?(a=1===parseInt(r)?r+" Favorite [-]":r+" Favorites [-]",o.data("favorite-action","unfavorite")):"unfavorite"===i&&(a=1===parseInt(r)?r+" Favorite [+]":r+" Favorites [+]",o.data("favorite-action","favorite")),0<s.length&&s.data("favorite-action",o.data("favorite-action")),o.text(a)},initFavoritesModal:function(){var t=this;n("#content article.single, .home #content article.post, .home #content article.sweepstakes, #content.archive article.post").on("click",".post-favorite-count, .meta-favorite-link",{type:"post"},t.showFavoritesModal),n("#comments").on("click",".comment-favorites a",{type:"comment"},t.showFavoritesModal),n(".series-share").on("click",".series-favorite-count",{type:"series"},t.showFavoritesModal),n("#content.series article.series").on("click",".series-favorite-count",{type:"series"},t.showFavoritesModal)},showFavoritesModal:function(t){t.preventDefault();var e=n(this),i=e.data("entity-id"),r=e.data("nonce"),o=e.data("favorite-action"),s={action:"favorite_modal",entity_id:i,favorite_action:o,nonce:r,type:t.data.type};n.ajax({type:"POST",url:tor_wp_vars.wp_ajax_url,data:s}).done(function(t){if(t){var e=n(t),r=e.find(".more-user-favorites"),o=e.find(".user-favorite-list"),a=r.data("nonce");r.on("click",function(t){t.preventDefault(),r.hide(),n.ajax({type:"POST",url:tor_wp_vars.wp_ajax_url,data:{action:"favorited_users_list",entity_id:i,nonce:a,type:s.type}}).done(function(t){o.remove(),e.find(".favorited-users").append(t)})}),n.modal(e,{opacity:60,overlayClose:!0,autoResize:!0,closeHTML:'<a class="modalCloseImg simplemodal-close" title="Close"><i class="icon-cancel"></i></a>'})}})},setFavoritedComments:function(t){var e=this,i=r.isUndefined(n.cookie("favorited-items"))?[]:n.cookie("favorited-items");t.find(".article-comments-post").each(function(){var t=n(this),r=t.find(".comment-favorites a"),o=r.data("entity-id");if(i.indexOf(o+"-comment")>-1){var s=t.find(".comment-favorites a");e.setFavoriteText(s)}})},setFavoriteStatus:function(t,e){var i=this,o=r.isUndefined(n.cookie("favorited-items"))?[]:n.cookie("favorited-items"),t=t,s=t.data("entity-id");return!tor_wp_vars.is_user_logged_in&&o.indexOf(s+"-"+e)>-1&&i.setFavoriteText(t),t},setFavoriteText:function(t){var e=t.html().match(/^[0-9]+/)[0];return t.html(1===parseInt(e)?e+" Favorite [-]":e+" Favorites [-]"),t.data("favorite-action","unfavorite"),t}}},function(t,e,i){var n=i(1),r=i(2),o=i(10);t.exports={initFictionExcerptLoadMoreListener:function(){var t=this;n("#tor-load-more").on("click",function(e){var i=n(this);i.hide(),i.after('<span class="infinite-loader"></span>'),n.ajax({type:"POST",url:tor_wp_vars.wp_ajax_url,data:{action:i.data("action"),nonce:i.data("nonce"),id:i.data("id"),offset:i.data("offset"),type:i.data("type")},dataType:"json"}).done(function(e){if(n(".infinite-loader").remove(),e){var s=e.offset;n("#archive-section-load-more-container").append(e.html),r.isFunction(o)?o():window.picturefill(),s>=i.data("numposts")?i.hide():i.show(),i.data("offset",s),i.attr("data-offset",s),t.hideProfileHeaders()}}),e.preventDefault()})},initAuthorButtonListener:function(){n(".post-section-button").on("click","a",function(t){n(".post-section-button").removeClass("active"),n(this).parent(".post-section-button").addClass("active")})},hideAuthorHeaders:function(){var t=[];n("#content").find(".author-archive-container").each(function(e){var i=n(this).data("author");if(t.push(i),e>=1){var r=t[e-1];r==i&&n(this).find(".author-archive-wrapper").hide()}})},hideProfileHeaders:function(){var t=[];n("#content").find(".profile-archive-container").each(function(e){var i=n(this).data("header");if(t.push(i),e>=1){var r=t[e-1];r==i&&n(this).find(".profile-header").hide()}})},initLoadMore:function(){var t=this;t.initFictionExcerptLoadMoreListener(),t.initAuthorButtonListener(),t.hideAuthorHeaders(),t.hideProfileHeaders(),n(document.body).on("post-load",function(){t.hideAuthorHeaders()})}}},function(t,e,i){var n=i(1);i(2),i(10);t.exports={initProfileUnsubscribe:function(){n(".subscribe-remove").on("click",function(t){var e=n(this);n.ajax({type:"POST",url:tor_wp_vars.wp_ajax_url,data:{action:"comment_subscribe",user_id:e.data("user_id"),post_id:e.data("post_id"),subscribe_type:"unsubscribe",nonce:e.data("nonce")}}).done(function(t){t&&n("#subscribe-"+e.data("post_id")).hide()}),t.preventDefault()})},initProfileSetActivityCounts:function(){0==n("#favorites-count").val()&&n("#activity-favs-personal-li").hide(),0==n("#comments-count").val()&&0==n("#favorites-count").val()&&0==n("#subscriptions-count").val()?n("#activity-personal-li").remove():(n("#just-me").append(" ("+n("#comments-count").val()+")"),n("#activity-favs").append(" ("+n("#favorites-count").val()+")"),n("#subscriptions").append(" ("+n("#subscriptions-count").val()+")"))},initProfileWYSIWYG:function(){n(window).load(function(){n(".field_about").find("textarea").length&&(n("body").addClass("wp-core-ui admin-color-fresh"),n("#link-selector > .howto, #link-selector > #search-panel").remove())})},initToggleCountryInputs:function(){var t=n("#buddypress .field_country").find("select"),e=n("#buddypress .field_zip-code");"United States"==t.val()?e.show():e.hide(),t.on("ready change",function(i){"United States"==t.val()?e.show():e.hide()})},initProfileDisplayNameChange:function(){var t=n(".field_name").find("input");t.on("change",function(e){n('#display_name option[name="nickname_option"]').text(t.val()),e.preventDefault()})},initProfile:function(){var t=this;t.initProfileSetActivityCounts(),t.initProfileWYSIWYG(),t.initProfileDisplayNameChange(),t.initProfileUnsubscribe(),t.initToggleCountryInputs()}}},,function(t,e,i){var n=i(1),r=i(3),o=i(2),s=function(t){var e=this;e.options=t||{},e.breakpoints=o.isUndefined(e.breakpoints)?[]:e.breakpoints,e.breakpoints=new r.Collection(e.breakpoints),o.isObject(e.breakpointViews)&&(o.isObject(e.breakpointViews.global)&&e.breakpointViews.global.activate(),o.each(e.breakpointViews,function(t,i){var n=e.breakpoints.findWhere({name:i});o.isObject(n)&&t.listenTo(n,"change:active",function(e,i){i===!0&&o.isFunction(t.activate)?t.activate():i===!1&&o.isFunction(t.deactivate)&&t.deactivate()})})),e._checkBreakpoints(),n(document).on("ready",function(){o.isFunction(e._checkBreakpoints)&&e._checkBreakpoints()}),n(window).on("resize",function(){o.isFunction(e._checkBreakpoints)&&e._checkBreakpoints()})};s.extend=r.Model.extend,o.extend(s.prototype,r.Events,{_checkBreakpoints:function(){var t,e=this,i=e.breakpoints,n=e._getWindowWidth();if(i.each(function(e){var i=e.get("width");i>=n&&(void 0===t||void 0!=t&&i<t.get("width"))&&(t=e)}),o.isUndefined(t)){var r=e.breakpoints.where({width:-1});r.length>0&&o.each(r,e.activateBreakpoint)}else e._activateBreakpoint(t)},_activateBreakpoint:function(t){var e=t.get("active");(o.isUndefined(e)||e===!1)&&t.set({active:!0})},_getWindowWidth:function(){return n(window).width()},_getWindowHeight:function(){return n(window).height()},getBreakpoint:function(t){var e=this;return e.breakpoints.where({name:t})}}),t.exports=s},function(t,e,i){var n=i(11),r=i(1),o=function(){var t=this,e=(t.$el.find("post-gallery-image"),function(e,i){"left"===i?t.nextSlide():"right"===i&&t.previousSlide()});r(".post-gallery").swipe({swipe:e,allowPageScroll:"vertical",threshold:0})};t.exports=function(t){var e=n.extend({el:t.el,slides:t.slides,initialize:o});return new e}},,,,,function(t,e,i){var n=i(8),r=i(7),o=i(5),s=i(1);i(3);t.exports=n.extend({regions:{comment_container:"#comments"},initialize:function(){var t=this;n.prototype.initialize.call(t)},activate:function(){var t=this;n.prototype.activate.call(t),t.initPostGalleries(),t.initModals(),t.setSidebarHeight(),tor_wp_vars.comments_enabled&&t.comment_container.$el.length>0&&o.initCommenting("desktop")},deactivate:function(){var t=this;n.prototype.activate.call(t),t.disableModals()},setSidebarHeight:function(){var t=s("#page-sidebar").height(),e=s("#content").height();t>e&&s("#content").css("min-height",t+"px")},initPostGalleries:function(){s(".gallery-controls").on("submit",function(t){t.preventDefault()}),s(".post-gallery").each(function(t){var e=s(this);r({el:e,slides:e.find(".post-gallery-image")})})},initModals:function(){s(".content-gallery .gallery-image").each(function(t){var e=s(this);e.data("args",{action:"modal_gallery",post_id:tor_wp_vars.post_id,type:"gallery"}).data("index",t)}),s(".modal-image").on("click",function(t){var e=s(this),i=e.data("args"),n=e.data("index"),o=function(t){if(_.isUndefined(t.data))var e=t.dialog,i=t.modal;else var e=t.data.dialog,i=t.data.modal;var n=e.data.outerHeight(!0),r=(e.data.find(".show").data("height"),e.data.outerWidth(!0),e.data.find(".show")),o=e.data.find(".hide"),a=r.find("img"),c=_.isUndefined(window.innerHeight)?s(window).height():window.innerHeight;if(o.removeClass("resized"),!r.hasClass("resized")){if(n+200>c){var l=c-400+"px";e.data.css("height",l),a.css("height",l),e.data.css("width","auto")}else e.data.css("height","auto"),e.data.css("width","auto");e.container.css("height","auto"),e.container.css("width","auto"),e.origHeight=0,e.origWidth=0,i.setContainerDimensions(),i.setPosition(),e.container.css("width","auto"),r.addClass("resized")}},a=function(t,e){var i=s(t),a=r({el:i,slides:".gallery-slide"});a.changeSlide(n),s.modal(i,{opacity:60,overlayClose:!0,autoResize:!0,closeHTML:'<a class="modalCloseImg simplemodal-close" title="Close"><i class="icon-cancel"></i></a>',onShow:function(t){t||(t=s.modal.impl.d),o({dialog:t,modal:s.modal}),i.find(".controls").on("click",{dialog:t,modal:s.modal},o)}})};t.preventDefault(),s.ajax({url:tor_wp_vars.wp_ajax_url,data:i,success:a})})},disableModals:function(){s(".modal-image").off("click")}})},function(t,e,i){var n=i(8),r=i(7),o=i(18),s=(i(5),i(17)),a=i(19),c=i(16),l=i(20),h=i(4),u=i(6),d=i(1);i(3);t.exports=n.extend({regions:{header_social:"#account-wrapper"},initialize:function(){var t=this;if(n.prototype.initialize.call(t),t.openSearch(),tor_wp_vars.is_user_logged_in||t.initModalAuth(),l.initProfile(),tor_wp_vars.is_home&&t.initHomepageSlideshow(),tor_wp_vars.is_single&&s.init(),a.initLoadMore(),c.initArchiveFilter(),o.initFavoriting(),""!==tor_wp_vars.post_id){var e=document.querySelectorAll(".content-footnote");e.length>0&&h.initCitations(e)}t.setExternalLinks(),u.init()},openSearch:function(){d(".search-toggle").on("click",function(){d(".search-toggle").toggleClass("active"),d("#searchform").toggleClass("active")})},setExternalLinks:function(){d(".entry-content a, #buddypress .profile a").not(".sd-button").each(function(){var t=d(this),e=t.attr("href"),i=t.prop("href",e).prop("hostname");i!=tor_wp_vars.site_domain&&t.attr("target","external-links-new-window")})},initModalAuth:function(){var t,e,i;d("#protected-comments-login").data("tracking");i=function(t){var e=d(t);d.modal(e,{opacity:60,overlayClose:!0,autoResize:!0,closeHTML:'<a class="modalCloseImg simplemodal-close" title="Close"><i class="icon-cancel"></i></a>'})},d("body").on("click",".login, #subscribe-login, #protected-comments-login",function(n){var r=d(this),o=d(this).data("tracking");t=tor_wp_vars.modal,e=d(t).find("#redirect_to").val(),i(t),d("#redirect_to").val(e),r.is("a")&&r.attr("href")&&"#"!=r.attr("href")&&d("#redirect_to").val(r.attr("href")),"protected-comments-login"===r.attr("id")&&d("#redirect_to").val(e+"#comments"),d("#login_tracking").val(o),n.preventDefault()})},initHomepageSlideshow:function(){r({el:"#homepage-featured-wrapper",slides:"#homepage-featured > .post"},{autoplay:!0})}})},function(t,e,i){var n=i(8),r=i(23),o=i(7),s=i(5),a=i(1);i(3);t.exports=n.extend({regions:{comment_container:"#comments"},events:{"click #menu-control":"openMenu","click #fiction-menu-control":"openFictionMenu","click #refine-search":"openSearchFilterForm"},initialize:function(){var t=this;n.prototype.initialize.call(t)},activate:function(){var t=this;n.prototype.activate.call(t),t.initPostGalleries(),t.initProfileSubMenu(),a(".back-to-top").on("click",function(t){t.preventDefault(),window.scrollTo(0,0)}),location.search.length&&t.openSearchFilterForm(),tor_wp_vars.comments_enabled&&t.comment_container.$el.length>0&&s.initCommenting("mobile")},deactivate:function(){var t=this;n.prototype.deactivate.call(t),t.disablePostGalleries()},initProfileSubMenu:function(){var t=a("#item-nav ul"),e=t.find(".current");e.length>0&&(t.children("li:first-child").before('<li class="trigger"><a href="#">'+e.text()+"</a></li>"),t.children("li:first-child").on("click",function(e){e.preventDefault(),t.children("li").not(".trigger").toggle()}))},openMenu:function(){a("#page-header").toggleClass("menu-open")},openFictionMenu:function(){var t=a("#refine-search").offset().top;a(".category-archive-meta").length>0&&(t=a(".category-archive-meta").offset().top+a(".category-archive-meta").outerHeight()),a("#fiction-navigation").css("top",t+"px"),a("#fiction-navigation").toggleClass("menu-open")},openSearchFilterForm:function(){a("#filterform").toggleClass("show")},initPostGalleries:function(){a(".post-gallery").each(function(t){var e=a(this);r({el:e,slides:e.find(".post-gallery-image")})}),a(".post-gallery-image, .gallery-image").on("click",function(t){var e=a(this),i=e.data("id"),n=e.parent(".post-gallery, .content-gallery"),r=_.map(n.find(".post-gallery-image, .gallery-image"),function(t,e){return a(t).data("id")});t.preventDefault(),a.ajax({url:tor_wp_vars.wp_ajax_url,data:{action:"modal_gallery",image_ids:r,type:"comic"},success:function(t){if(t){var e=a(t),n=0,r=o({el:e,slides:".gallery-slide"});_.each(e.find(".gallery-slide"),function(t,e,r){a(t).data("id");a(t).data("id")===i&&(n=e)}),r.changeSlide(n),a.modal(e,{opacity:60,overlayClose:!0,autoResize:!0,closeHTML:'<a class="modalCloseImg simplemodal-close comic" title="Close"><i class="icon-cancel"></i></a>'})}}})})},disablePostGalleries:function(){a(".post-gallery-image").off("click")}})},,,,,function(t,e,i){var n,r;!function(o,s){n=[i(3),i(2)],r=function(t,e){return s(t,e)}.apply(e,n),!(void 0!==r&&(t.exports=r))}(this,function(t,e){"use strict";var i=t.ChildViewContainer;return t.ChildViewContainer=function(t,e){var i=function(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),e.each(t,this.add,this)};e.extend(i.prototype,{add:function(t,e){var i=t.cid;return this._views[i]=t,t.model&&(this._indexByModel[t.model.cid]=i),e&&(this._indexByCustom[e]=i),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return e.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var i=t.cid;return t.model&&delete this._indexByModel[t.model.cid],e.any(this._indexByCustom,function(t,e){if(t===i)return delete this._indexByCustom[e],!0},this),delete this._views[i],this._updateLength(),this},call:function(t){this.apply(t,e.tail(arguments))},apply:function(t,i){e.each(this._views,function(n){e.isFunction(n[t])&&n[t].apply(n,i||[])})},_updateLength:function(){this.length=e.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return e.each(n,function(t){i.prototype[t]=function(){var i=e.values(this._views),n=[i].concat(e.toArray(arguments));return e[t].apply(e,n)}}),i}(t,e),t.ChildViewContainer.VERSION="0.1.11",t.ChildViewContainer.noConflict=function(){return t.ChildViewContainer=i,this},t.ChildViewContainer})},function(t,e,i){var n,r;!function(o,s){n=[i(3),i(2),i(37),i(35)],r=function(t,e){return o.Marionette=o.Mn=s(o,t,e)}.apply(e,n),!(void 0!==r&&(t.exports=r))}(this,function(t,e,i){"use strict";var n=t.Marionette,r=t.Mn,o=e.Marionette={};o.VERSION="2.4.7",o.noConflict=function(){return t.Marionette=n,t.Mn=r,this},o.Deferred=e.$.Deferred,o.FEATURES={},o.isEnabled=function(t){return!!o.FEATURES[t]},o.extend=e.Model.extend,o.isNodeAttached=function(t){return e.$.contains(document.documentElement,t)},o.mergeOptions=function(t,e){t&&i.extend(this,i.pick(t,e))},o.getOption=function(t,e){if(t&&e)return t.options&&void 0!==t.options[e]?t.options[e]:t[e]},o.proxyGetOption=function(t){return o.getOption(this,t)},o._getValue=function(t,e,n){return i.isFunction(t)&&(t=n?t.apply(e,n):t.call(e)),t},o.normalizeMethods=function(t){return i.reduce(t,function(t,e,n){return i.isFunction(e)||(e=this[e]),e&&(t[n]=e),t},{},this)},o.normalizeUIString=function(t,e){return t.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(t){return e[t.slice(4)]})},o.normalizeUIKeys=function(t,e){return i.reduce(t,function(t,i,n){var r=o.normalizeUIString(n,e);return t[r]=i,t},{})},o.normalizeUIValues=function(t,e,n){return i.each(t,function(r,s){i.isString(r)?t[s]=o.normalizeUIString(r,e):i.isObject(r)&&i.isArray(n)&&(i.extend(r,o.normalizeUIValues(i.pick(r,n),e)),i.each(n,function(t){var n=r[t];i.isString(n)&&(r[t]=o.normalizeUIString(n,e))}))}),t},o.actAsCollection=function(t,e){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){t[n]=function(){var t=i.values(i.result(this,e)),r=[t].concat(i.toArray(arguments));return i[n].apply(i,r)}})};var s=o.deprecate=function(t,e){i.isObject(t)&&(t=t.prev+" is going to be removed in the future. Please use "+t.next+" instead."+(t.url?" See: "+t.url:"")),void 0!==e&&e||s._cache[t]||(s._warn("Deprecation warning: "+t),s._cache[t]=!0)};s._console="undefined"!=typeof console?console:{},s._warn=function(){var t=s._console.warn||s._console.log||function(){};return t.apply(s._console,arguments)},s._cache={},o._triggerMethod=function(){function t(t,e,i){return i.toUpperCase()}var e=/(^|:)(\w)/gi;return function(n,r,o){var s=arguments.length<3;s&&(o=r,r=o[0]);var a,c="on"+r.replace(e,t),l=n[c];return i.isFunction(l)&&(a=l.apply(n,s?i.rest(o):o)),i.isFunction(n.trigger)&&(s+o.length>1?n.trigger.apply(n,s?o:[r].concat(i.drop(o,0))):n.trigger(r)),a}}(),o.triggerMethod=function(t){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(t){var e=i.isFunction(t.triggerMethod)?t.triggerMethod:o.triggerMethod;return e.apply(t,i.rest(arguments))},o.MonitorDOMRefresh=function(t){function e(){t._isShown=!0,n()}function i(){t._isRendered=!0,n()}function n(){t._isShown&&t._isRendered&&o.isNodeAttached(t.el)&&o.triggerMethodOn(t,"dom:refresh",t)}t._isDomRefreshMonitored||(t._isDomRefreshMonitored=!0,t.on({show:e,render:i}))},function(t){function e(e,n,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=e[i];if(!o)throw new t.Error('Method "'+i+'" was configured as an event handler, but does not exist.');e.listenTo(n,r,o)})}function n(t,e,i,n){t.listenTo(e,i,n)}function r(t,e,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=t[i];t.stopListening(e,n,r)})}function o(t,e,i,n){t.stopListening(e,i,n)}function s(e,n,r,o,s){if(n&&r){if(!i.isObject(r))throw new t.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=t._getValue(r,e),i.each(r,function(t,r){i.isFunction(t)?o(e,n,r,t):s(e,n,r,t)})}}t.bindEntityEvents=function(t,i,r){s(t,i,r,n,e)},t.unbindEntityEvents=function(t,e,i){s(t,e,i,o,r)},t.proxyBindEntityEvents=function(e,i){return t.bindEntityEvents(this,e,i)},t.proxyUnbindEntityEvents=function(e,i){return t.unbindEntityEvents(this,e,i)}}(o);var a=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(t,e){i.isObject(t)?(e=t,t=e.message):e||(e={});var n=Error.call(this,t);i.extend(this,i.pick(n,a),i.pick(e,a)),this.captureStackTrace(),e.url&&(this.url=this.urlRoot+e.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(t,e){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:e}),n.then(function(i){e&&(i.context=e),t.call(i.context,i.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),o.Controller=function(t){this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,e.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption}),o.Object=function(t){this.options=i.extend({},i.result(this,"options"),t),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,e.Events,{initialize:function(){},destroy:function(t){return t=t||{},this.triggerMethod("before:destroy",t),this.triggerMethod("destroy",t),this.stopListening(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof e.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,t)},show:function(t,e){if(this._ensureElement()){this._ensureViewIsIntact(t),o.MonitorDOMRefresh(t);var n=e||{},r=t!==this.currentView,s=!!n.preventDestroy,a=!!n.forceShow,c=!!this.currentView,l=r&&!s,h=r||a;if(c&&this.triggerMethod("before:swapOut",this.currentView,this,e),this.currentView&&r&&delete this.currentView._parent,l?this.empty():c&&h&&this.currentView.off("destroy",this.empty,this),h){t.once("destroy",this.empty,this),t._parent=this,this._renderView(t),c&&this.triggerMethod("before:swap",t,this,e),this.triggerMethod("before:show",t,this,e),o.triggerMethodOn(t,"before:show",t,this,e),c&&this.triggerMethod("swapOut",this.currentView,this,e);var u=o.isNodeAttached(this.el),d=[],f=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return u&&f.triggerBeforeAttach&&(d=this._displayedViews(t),this._triggerAttach(d,"before:")),this.attachHtml(t),this.currentView=t,u&&f.triggerAttach&&(d=this._displayedViews(t),this._triggerAttach(d)),c&&this.triggerMethod("swap",t,this,e),this.triggerMethod("show",t,this,e),o.triggerMethodOn(t,"show",t,this,e),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(t,e){var n=(e||"")+"attach";i.each(t,function(t){o.triggerMethodOn(t,n,t,this)},this)},_displayedViews:function(t){return i.union([t],i.result(t,"_getNestedViews")||[])},_renderView:function(t){t.supportsRenderLifecycle||o.triggerMethodOn(t,"before:render",t),t.render(),t.supportsRenderLifecycle||o.triggerMethodOn(t,"render",t)},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(t){if(!t)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(t.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+t.cid+'") has already been destroyed and cannot be used.'})},getEl:function(t){return e.$(t,o._getValue(this.options.parentEl,this))},attachHtml:function(t){this.$el.contents().detach(),this.el.appendChild(t.el)},empty:function(t){var e=this.currentView,i=t||{},n=!!i.preventDestroy;return e?(e.off("destroy",this.empty,this),this.triggerMethod("before:empty",e),n||this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,n&&this.$el.contents().detach(),this):this},_destroyView:function(){var t=this.currentView;t.isDestroyed||(t.supportsDestroyLifecycle||o.triggerMethodOn(t,"before:destroy",t),t.destroy?t.destroy():(t.remove(),t.isDestroyed=!0),t.supportsDestroyLifecycle||o.triggerMethodOn(t,"destroy",t))},attachView:function(t){return this.currentView&&delete this.currentView._parent,t._parent=this,this.currentView=t,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(t,e){if(i.isString(t))return this._buildRegionFromSelector(t,e);if(t.selector||t.el||t.regionClass)return this._buildRegionFromObject(t,e);if(i.isFunction(t))return this._buildRegionFromRegionClass(t);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(t,e){return new e({el:t})},_buildRegionFromObject:function(t,e){var n=t.regionClass||e,r=i.omit(t,"selector","regionClass");return t.selector&&!r.el&&(r.el=t.selector),new n(r)},_buildRegionFromRegionClass:function(t){return new t}}),o.RegionManager=o.Controller.extend({constructor:function(t){this._regions={},this.length=0,o.Controller.call(this,t),this.addRegions(this.getOption("regions"))},addRegions:function(t,e){return t=o._getValue(t,this,arguments),i.reduce(t,function(t,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,e)),t[r]=this.addRegion(r,n),t},{},this)},addRegion:function(t,e){var i;return i=e instanceof o.Region?e:o.Region.buildRegion(e,o.Region),this.triggerMethod("before:add:region",t,i),i._parent=this,this._store(t,i),this.triggerMethod("add:region",t,i),i},get:function(t){return this._regions[t]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];return this._remove(t,e),e},removeRegions:function(){var t=this.getRegions();return i.each(this._regions,function(t,e){this._remove(e,t)},this),t},emptyRegions:function(){var t=this.getRegions();return i.invoke(t,"empty"),t},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]||this.length++,this._regions[t]=e},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete e._parent,delete this._regions[t],this.length--,this.triggerMethod("remove:region",t,e)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(t){this.templateId=t},i.extend(o.TemplateCache,{templateCaches:{},get:function(t,e){var i=this.templateCaches[t];return i||(i=new o.TemplateCache(t),this.templateCaches[t]=i),i.load(e)},clear:function(){var t,e=i.toArray(arguments),n=e.length;if(n>0)for(t=0;t<n;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(t){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId,t);return this.compiledTemplate=this.compileTemplate(e,t),this.compiledTemplate},loadTemplate:function(t,i){var n=e.$(t);if(!n.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+t+'"'});return n.html()},compileTemplate:function(t,e){return i.template(t,e)}}),o.Renderer={render:function(t,e){if(!t)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=i.isFunction(t)?t:o.TemplateCache.get(t);return n(e)}},o.View=e.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(t){this.render=i.bind(this.render,this),t=o._getValue(t,this),this.options=i.extend({},i.result(this,"options"),t),this._behaviors=o.Behaviors(this),e.View.call(this,this.options),o.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(t){return t.toJSON.apply(t,i.rest(arguments))},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return e=o._getValue(e,this),i.extend(t,e)},normalizeUIKeys:function(t){var e=i.result(this,"_uiBindings");return o.normalizeUIKeys(t,e||i.result(this,"ui"))},normalizeUIValues:function(t,e){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return o.normalizeUIValues(t,r||n,e)},configureTriggers:function(){if(this.triggers){var t=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(t,function(t,e,i){return t[i]=this._buildViewTrigger(e),t},{},this)}},delegateEvents:function(t){return this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(t){t.bindEntityEvents(this.model,t.getOption("modelEvents")),t.bindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(t){var n=o._getValue(t||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(t)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),c=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,a,c),e.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return e.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(t){t.unbindEntityEvents(this.model,t.getOption("modelEvents")),t.unbindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var t=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",t),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=i.result(this,"_uiBindings");this.ui={},i.each(t,function(t,e){this.ui[e]=this.$(t)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(t){var e=i.defaults({},t,{preventDefault:!0,stopPropagation:!0}),n=i.isObject(t)?e.event:t;return function(t){t&&(t.preventDefault&&e.preventDefault&&t.preventDefault(),t.stopPropagation&&e.stopPropagation&&t.stopPropagation());var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,i)}},setElement:function(){var t=e.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),t},triggerMethod:function(){var t=o._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),t},_triggerEventOnBehaviors:function(t){for(var e=o._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;n<r;n++)e(i[n],t)},_triggerEventOnParentLayout:function(t,e){var n=this._parentLayoutView();if(n){var r=o.getOption(n,"childViewEventPrefix"),s=r+":"+t,a=[this].concat(e);o._triggerMethod(n,s,a);var c=o.getOption(n,"childEvents");c=o._getValue(c,n);var l=n.normalizeMethods(c);l&&i.isFunction(l[t])&&l[t].apply(n,a)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var t=this._getImmediateChildren();return t.length?i.reduce(t,function(t,e){return e._getNestedViews?t.concat(e._getNestedViews()):t},t):t},_parentLayoutView:function(){for(var t=this._parent;t;){if(t instanceof o.LayoutView)return t;t=t._parent}},normalizeMethods:o.normalizeMethods,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var t=[this.model||this.collection];return arguments.length&&t.push.apply(t,arguments),this.model?this.serializeModel.apply(this,t):{items:this.serializeCollection.apply(this,t)}},serializeCollection:function(t){return t.toJSON.apply(t,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var t=this.getTemplate();if(t!==!1){if(!t)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var e=this.mixinTemplateHelpers(this.serializeData()),i=o.Renderer.render(t,e,this);return this.attachElContent(i),this}},attachElContent:function(t){return this.$el.html(t),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(t){this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var t,e=this._isShown&&o.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),e&&this._triggerBeforeAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),e&&this._triggerAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(t,e,n){var r=i.drop(arguments,3);i.each(t,function(t){o.triggerMethodOn.apply(t,[t,n,t,e].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t,e,n){var r=void 0!==n.at&&(n.index||e.indexOf(t));if((this.getOption("filter")||r===!1)&&(r=i.indexOf(this._filteredSortedModels(r),t)),this._shouldAddChild(t,r)){this.destroyEmptyView();var o=this.getChildView(t);this.addChild(t,o,r)}},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(t){o.triggerMethodOn(t,"before:show",t)})},_onShowCalled:function(){this.children.each(function(t){o.triggerMethodOn(t,"show",t)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var t=this.children,e=this._filteredSortedModels();if(!e.length&&this._showingEmptyView)return this;var n=i.some(e,function(e){return!t.findByModel(e)});if(n)this.render();else{var r=i.map(e,function(e,i){var n=t.findByModel(e);return n._index=i,n.el}),o=t.filter(function(t){return!i.contains(r,t.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(r),i.each(o,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){o.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var t=this._filteredSortedModels(),e=i.find(t,function(t,e){var i=this.children.findByModel(t);return!i||i._index!==e},this);e&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(t){this.$el.append(t)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var t,e=this._filteredSortedModels();i.each(e,function(e,i){t=this.getChildView(e),this.addChild(e,t,i)},this)},_filteredSortedModels:function(t){var e=this.getViewComparator(),n=this.collection.models;if(t=Math.min(Math.max(t,0),n.length-1),e){var r;t&&(r=n[t],n=n.slice(0,t).concat(n.slice(t+1))),n=this._sortModelsBy(n,e),r&&n.splice(t,0,r)}return this.getOption("filter")&&(n=i.filter(n,function(t,e){return this._shouldAddChild(t,e)},this)),n},_sortModelsBy:function(t,e){return"string"==typeof e?i.sortBy(t,function(t){return t.get(e)},this):1===e.length?i.sortBy(t,e,this):t.sort(i.bind(e,this))},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new e.Model;this.addEmptyView(i,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var n,r=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(s)&&(s=s.call(this,t,this._emptyViewIndex));var a=this.buildChildView(t,e,s);a._parent=this,this.proxyChildEvents(a),a.once("render",function(){this._isShown&&o.triggerMethodOn(a,"before:show",a),r&&this._triggerBeforeAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(a),this.renderChildView(a,this._emptyViewIndex),r&&this._triggerAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"attach")),this._isShown&&o.triggerMethodOn(a,"show",a)},getChildView:function(t){var e=this.getOption("childView");if(!e)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return e},addChild:function(t,e,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[t,i]);var r=this.buildChildView(t,e,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(t,e,i){this.getOption("sort")&&(e&&(t._index=i),this.children.each(function(i){i._index>=t._index&&(i._index+=e?1:-1)}))},_addChildView:function(t,e){var i,n=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el);this.proxyChildEvents(t),t.once("render",function(){this._isShown&&!this.isBuffering&&o.triggerMethodOn(t,"before:show",t),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(t),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(t),this.renderChildView(t,e),n&&this._triggerAttach&&(i=this._getViewAndNested(t),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&o.triggerMethodOn(t,"show",t)},renderChildView:function(t,e){return t.supportsRenderLifecycle||o.triggerMethodOn(t,"before:render",t),t.render(),t.supportsRenderLifecycle||o.triggerMethodOn(t,"render",t),this.attachHtml(this,t,e),t},buildChildView:function(t,e,n){var r=i.extend({model:t},n),s=new e(r);return o.MonitorDOMRefresh(s),s},removeChildView:function(t){return t?(this.triggerMethod("before:remove:child",t),t.supportsDestroyLifecycle||o.triggerMethodOn(t,"before:destroy",t),t.destroy?t.destroy():t.remove(),t.supportsDestroyLifecycle||o.triggerMethodOn(t,"destroy",t),delete t._parent,this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1),t):t},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},_createBuffer:function(){var t=document.createDocumentFragment();return i.each(this._bufferedChildren,function(e){t.appendChild(e.el)}),t},attachHtml:function(t,e,i){t.isBuffering?t._bufferedChildren.splice(i,0,e):t._insertBefore(e,i)||t._insertAfter(e)},_insertBefore:function(t,e){var i,n=this.getOption("sort")&&e<this.children.length-1;return n&&(i=this.children.find(function(t){return t._index===e+1})),!!i&&(i.$el.before(t.el),!0)},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(t){var e=t||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(e.checkEmpty)||(n=e.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(t,e){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,t,e,this.collection)},proxyChildEvents:function(t){var e=this.getOption("childViewEventPrefix");this.listenTo(t,"all",function(){var n=i.toArray(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=e+":"+r,n.splice(1,0,t),"undefined"!=typeof o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},_getViewAndNested:function(t){return[t].concat(i.result(t,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(t){var e=this.getOption("childView")||this.constructor;return e},serializeData:function(){var t={};return this.model&&(t=i.partial(this.serializeModel,this.model).apply(this,arguments)),t},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),i=o.Renderer.render(e,t,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){var i=this.getChildViewContainer(t);i.append(e)},_insertAfter:function(t){var e=this.getChildViewContainer(this,t);e.append(t.el)},_appendReorderedChildren:function(t){var e=this.getChildViewContainer(this);e.append(t)},getChildViewContainer:function(t,e){if(t.$childViewContainer)return t.$childViewContainer;var i,n=o.getOption(t,"childViewContainer");if(n){var r=o._getValue(n,t);if(i="@"===r.charAt(0)&&t.ui?t.ui[r.substr(4)]:t.$(r),i.length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+t.childViewContainer})}else i=t.$el;return t.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),o.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(t,e,n){var r=this.getRegion(t);return r.show.apply(r,i.rest(arguments))},getChildView:function(t){return this.getRegion(t).currentView},addRegion:function(t,e){var i={};return i[t]=e,this._buildRegions(i)[t]},addRegions:function(t){return this.regions=i.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(t,e)},_initializeRegions:function(t){var e;this._initRegionManager(),e=o._getValue(this.regions,this,[t])||{};var n=this.getOption.call(t,"regions");n=o._getValue(n,this,[t]),i.extend(e,n),e=this.normalizeUIValues(e,["selector","el"]),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(t,e){this.view=e,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,t),this.ui=i.extend({},i.result(e,"ui"),i.result(this,"ui")),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(t){this.$el=t.$el,this.el=t.el}}),o.Behaviors=function(t,e){function i(t,n){return e.isObject(t.behaviors)?(n=i.parseBehaviors(t,n||e.result(t,"behaviors")),i.wrap(t,n,e.keys(s)),n):{}}function n(t,e){this._view=t,this._behaviors=e,this._triggers={}}function r(t){return t._uiBindings||t.ui}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(t,e){var i=new n(this,e);return i.buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={};return e.each(n,function(i,n){var a={},c=e.clone(e.result(i,"events"))||{};c=t.normalizeUIKeys(c,r(i));var l=0;e.each(c,function(t,r){var s=r.match(o),c=s[1]+"."+[this.cid,n,l++," "].join(""),h=s[2],u=c+h,d=e.isFunction(t)?t:i[t];d&&(a[u]=e.bind(d,i))},this),s=e.extend(s,a)},this),s}};return e.extend(i,{behaviorsLookup:function(){throw new t.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(e,n){return e.behaviorClass?e.behaviorClass:t._getValue(i.behaviorsLookup,this,[e,n])[n]},parseBehaviors:function(t,n){return e.chain(n).map(function(n,r){var o=i.getBehaviorClass(n,r),s=new o(n,t),a=i.parseBehaviors(t,e.result(s,"behaviors"));return[s].concat(a)}).flatten().value()},wrap:function(t,i,n){e.each(n,function(n){t[n]=e.partial(s[n],t[n],i)})}}),e.extend(n.prototype,{buildBehaviorTriggers:function(){return e.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=e.clone(e.result(i,"triggers"))||{};o=t.normalizeUIKeys(o,r(i)),e.each(o,e.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(t,e,i,n){var r=n.replace(/^\S+/,function(t){return t+".behaviortriggers"+e});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=e.Router.extend({constructor:function(t){this.options=t||{},e.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var i=this._getController();this._addAppRoute(i,t,e)},_processOnRoute:function(t,e){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[t];this.onRoute(t,n,e)}},processAppRoutes:function(t,e){if(e){var n=i.keys(e).reverse();i.each(n,function(i){this._addAppRoute(t,i,e[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,n){var r=t[n];if(!r)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(e,n,i.bind(r,t))},mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(t){this._initializeRegions(t),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,t),this._initChannel(),o.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(t){return this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var n=o.Module.getClass(e),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(t){var e=i.isFunction(this.regions)?this.regions(t):this.regions||{};this._initRegionManager();var n=o.getOption(t,"regions");return i.isFunction(n)&&(n=n.call(this,t)),i.extend(e,n),this.addRegions(e),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(t){delete this[t],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||e.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(t,e,n){this.moduleName=t,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,i.isFunction(this.initialize)&&this.initialize(t,e,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,e.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(i.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,n){if(t){var r=i.flatten([this,this.app,e,o,e.$,i,n]);t.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(t,e,n){var r=t,o=i.drop(arguments,3);e=e.split(".");var s=e.length,a=[];return a[s-1]=n,i.each(e,function(e,i){var s=r;r=this._getModule(s,e,t,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(t,e,n,r,o){var s=i.extend({},r),a=this.getClass(r),c=t[e];return c||(c=new a(e,n,s),t[e]=c,t.submodules[e]=c),c},getClass:function(t){var e=o.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,e);r&&e.addDefinition(r,n),this._addStartWithParent(t,e,o)},_getStartWithParent:function(t,e){var n;return i.isFunction(t)&&t.prototype instanceof o.Module?(n=e.constructor.prototype.startWithParent,!!i.isUndefined(n)||n):!i.isObject(t)||(n=t.startWithParent,!!i.isUndefined(n)||n)},_getDefine:function(t){return!i.isFunction(t)||t.prototype instanceof o.Module?i.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,i){e.startWithParent=e.startWithParent&&i,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),o})},function(t,e,i){var n,r;!function(o,s){n=[i(3),i(2)],r=function(t,e){return s(t,e)}.apply(e,n),!(void 0!==r&&(t.exports=r))}(this,function(t,e){"use strict";var i=t.Wreqr,n=t.Wreqr={};return t.Wreqr.VERSION="1.4.0",t.Wreqr.noConflict=function(){return t.Wreqr=i,this},n.Handlers=function(t,e){var i=function(t){this.options=t,this._wreqrHandlers={},e.isFunction(this.initialize)&&this.initialize(t)};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events,{setHandlers:function(t){e.each(t,e.bind(function(t,i){var n=null;e.isObject(t)&&!e.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(i,t,n)},this))},setHandler:function(t,e,i){var n={callback:e,context:i};this._wreqrHandlers[t]=n,this.trigger("handler:add",t,e,i)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){return e.callback.apply(e.context,arguments)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(t,e),n.CommandStorage=function(){var i=function(t){this.options=t,this._commands={},e.isFunction(this.initialize)&&this.initialize(t)};return e.extend(i.prototype,t.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){var i=this.getCommands(t);i.instances.push(e)},clearCommands:function(t){var e=this.getCommands(t);e.instances=[]}}),i}(),n.Commands=function(t,e){return t.Handlers.extend({storageType:t.CommandStorage,constructor:function(e){this.options=e||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),t.Handlers.prototype.constructor.apply(this,arguments)},execute:function(t){t=arguments[0];var i=e.rest(arguments);this.hasHandler(t)?this.getHandler(t).apply(this,i):this.storage.addCommand(t,i)},_executeCommands:function(t,i,n){var r=this.storage.getCommands(t);e.each(r.instances,function(t){i.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var i,n=t.storageType||this.storageType;i=e.isFunction(n)?new n:n,this.storage=i}})}(n,e),n.RequestResponse=function(t,e){return t.Handlers.extend({request:function(t){if(this.hasHandler(t))return this.getHandler(t).apply(this,e.rest(arguments))}})}(n,e),n.EventAggregator=function(t,e){var i=function(){};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events),i}(t,e),n.Channel=function(i){var n=function(e){this.vent=new t.Wreqr.EventAggregator,this.reqres=new t.Wreqr.RequestResponse,this.commands=new t.Wreqr.Commands,this.channelName=e};return e.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(t,i,n){if(i){n=n||this;var r="vent"===t?"on":"setHandler";e.each(i,e.bind(function(i,o){this[t][r](o,e.bind(i,n))},this))}}}),n}(n),n.radio=function(t,e){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};e.extend(i.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(e){var i=this._channels[e];return i||(i=new t.Channel(e),this._channels[e]=i),i},_proxyMethods:function(){e.each(["vent","commands","reqres"],e.bind(function(t){e.each(n[t],e.bind(function(e){this[t][e]=r(this,t,e)},this))},this))}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(t,i,n){return function(r){var o=t._getChannel(r)[i];return o[n].apply(o,e.rest(arguments))}};return new i}(n,e),t.Wreqr})},,,,,,,function(t,e){}]);